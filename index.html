<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEIU Creative Collection</title>

    <!-- Flicking CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@egjs/flicking@4.11.3/dist/flicking.css">

    <link rel="stylesheet" href="styles.css">

    <!-- Flicking ë¡œë“œ í›„ startApp ì‹¤í–‰ -->
    <script>
        const flickScript = document.createElement("script");
        flickScript.src = "https://cdn.jsdelivr.net/npm/@egjs/flicking@4.11.3/dist/flicking.pkgd.min.js";

        flickScript.onload = () => {
            console.log("Flicking loaded!");
            startApp(); // ğŸ”¥ ëª¨ë“  JS ì‹¤í–‰ì€ ì—¬ê¸°ì„œë§Œ ì‹œì‘
        };

        document.head.appendChild(flickScript);
    </script>
</head>

<body>

    <!-- WebGL Canvas Background -->
    <div id="canvas-container">
        <canvas id="glCanvas"></canvas>
    </div>

    <!-- Grain Overlay -->
    <div class="noise-overlay"></div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-top">
                    <div class="archive-menu">
                        <div class="archive-selector">
                            <div class="archive-button" id="archive-button">
                                <span class="archive-label">2025</span>
                            </div>
                            <div class="archive-dropdown" id="archive-dropdown">
                                <div class="archive-option active" data-year="2025">2025</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="logo-container">
                    <img src="jeiu-logo.svg" class="jeiu-logo">
                </div>

                <span class="brand-tag">Creative Collection</span>
                <h2>Computer Software<br>Graduation Projects</h2>
                <p class="subtitle">
                    ì¬ëŠ¥ëŒ€í•™êµ ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼ ì¡¸ì—…ì‘í’ˆ ì•„ì¹´ì´ë¸Œ.<br>
                    í•™ìƒë“¤ì˜ ì—´ì •ê³¼ ê¸°ìˆ ì´ ë‹´ê¸´ í”„ë¡œì íŠ¸ë“¤ì„ ì˜êµ¬íˆ ê¸°ë¡í•©ë‹ˆë‹¤.
                </p>
            </div>
        </header>

        <section class="gallery-section">
            <div class="grid" id="project-grid"></div>
        </section>

        <!-- Modal -->
        <div id="video-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="close-modal">&times;</span>
                <div class="video-container">
                    <iframe id="video-frame" width="100%" height="400" allowfullscreen></iframe>
                </div>
                <div class="video-tabs" id="video-tabs">
                    <button class="tab-button active" data-video-type="interim">ì¤‘ê°„ë°œí‘œ</button>
                    <button class="tab-button" data-video-type="final">ìµœì¢…ë°œí‘œ</button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 JEIU University Computer Software Dept. All rights reserved.</p>
        </footer>
    </div>

    <!-- ===============================================================
         Flicking ë¡œë“œ í›„ì—ë§Œ ì‹¤í–‰ë˜ëŠ” ì „ì²´ ê¸°ëŠ¥ startApp()
    ================================================================ -->
    <script>
        function startApp() {

            /* ------------------------------------------------------------
                Flicking ì´ˆê¸°í™” (Flicking ë¡œë“œ ì´í›„ì´ë¯€ë¡œ eg 100% ì¡´ì¬)
            ------------------------------------------------------------- */
            function initFlicking() {
                document.querySelectorAll(".team-carousel").forEach(carousel => {
                    if (carousel._flickingInstance) return;

                    const flick = new Flicking(carousel, {
                        align: "prev",
                        moveType: "snap",
                        gap: 10,
                        adaptive: true,
                        bound: true,
                        panelsPerView: 2.5,
                        defaultIndex: 1,
                    });

                    carousel._flickingInstance = flick;
                });
            }


            /* ------------------------ í•™ìƒ JSON ë¡œë“œ ------------------------ */
            async function loadStudentData() {
                try {
                    const res = await fetch("students.json");
                    return await res.json();
                } catch {
                    return {};
                }
            }

            /* ------------------------ í”„ë¡œì íŠ¸ JSON ë¡œë“œ ------------------------ */
            async function loadProjectData(studentData, year) {
                try {
                    const res = await fetch("data.json");
                    const data = await res.json();

                    let all = [];

                    Object.values(data).forEach(list => {
                        list.forEach(team => {
                            const members = team["ì¡°ì›"].map(n => ({
                                name: n,
                                img: (studentData[n]?.img) ??
                                    "https://via.placeholder.com/100/444444/FFFFFF?text=?"
                            }));

                            all.push({
                                id: team.id,
                                title: team["ì¡°ì´ë¦„"],
                                description: team["ì‘í’ˆì„¤ëª…"],
                                platform: team["ì˜ˆìƒí”Œë«í¼"],
                                presentationVideo: team["ì¤‘ê°„ë°œí‘œì˜ìƒ"],
                                finalPresentationVideo: team["ìµœì¢…ë°œí‘œì˜ìƒ"],
                                presenters: team["ìµœì¢…ë°œí‘œì"],
                                teamMembersWithImages: members,
                                year
                            });
                        });
                    });

                    return all;
                } catch {
                    return [];
                }
            }

            /* ----------------------------- íŒ€ ì¹´ë“œ ìƒì„± ----------------------------- */
            async function generateTeamCards(year) {

                const grid = document.getElementById("project-grid");
                grid.innerHTML = "";

                const students = await loadStudentData();
                const projects = await loadProjectData(students, year);

                projects.forEach(p => {
                    const card = document.createElement("div");
                    card.className = "card";

                    card.innerHTML = `
                        <div class="card-image">
                            <img src="example.webp" onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg,#ff4d00,#ff8c00)'">
                            <div class="card-badge">${p.platform}</div>
                        </div>

                        <div class="card-content">
                            <h3 class="card-title">${p.title}</h3>

                            <div class="card-team-members">
                                <div class="team-carousel flicking-viewport">
                                    <div class="flicking-camera">
                                        ${p.teamMembersWithImages.map(m => `
                                            <div class="flicking-panel carousel-panel">
                                                <div class="member-avatar">
                                                    <img src="${m.img}" onerror="this.src='https://via.placeholder.com/100/444444/FFFFFF?text=?'">
                                                </div>
                                                <div class="member-name">${m.name}</div>
                                            </div>
                                        `).join("")}
                                    </div>
                                </div>
                            </div>

                            <p class="card-description">${p.description}</p>
                            <div class="card-links">
                                ${(p.presentationVideo || p.finalPresentationVideo) ? `<a href="#" class="embed-video" data-interim-url="${p.presentationVideo || ''}" data-final-url="${p.finalPresentationVideo || ''}" data-title="${p.title}">ë°œí‘œ ì˜ìƒ ë³´ê¸°</a>` : ""}
                            </div>
                        </div>
                    `;

                    grid.appendChild(card);
                });

                initFlicking();
                setupVideoButtons();
            }


            /* ------------------------- ìœ íŠœë¸Œ ëª¨ë‹¬ ------------------------- */
            let currentVideoData = {
                interimUrl: '',
                finalUrl: '',
                currentType: 'interim'
            };

            function extractVideoId(url) {
                const reg = /^.*(youtu.be\/|v\/|embed\/|watch\?v=)([^#&?]*).*/;
                const m = url.match(reg);
                return m && m[2]?.length === 11 ? m[2] : null;
            }

            function switchVideoTab(type) {
                const tabs = document.querySelectorAll('.tab-button');
                const modal = document.getElementById('video-modal');
                const videoFrame = document.getElementById('video-frame');

                // Update tab active states
                tabs.forEach(tab => {
                    if (tab.dataset.videoType === type) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });

                // Update current type and load video
                currentVideoData.currentType = type;
                const videoUrl = type === 'interim' ? currentVideoData.interimUrl : currentVideoData.finalUrl;

                if (videoUrl) {
                    const videoId = extractVideoId(videoUrl);
                    if (videoId) {
                        videoFrame.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                    }
                }
            }

            function setupVideoButtons() {
                document.querySelectorAll(".embed-video").forEach(btn => {
                    btn.onclick = e => {
                        e.preventDefault();

                        // Store video data
                        currentVideoData.interimUrl = btn.dataset.interimUrl;
                        currentVideoData.finalUrl = btn.dataset.finalUrl;

                        // Reset to interim tab initially
                        currentVideoData.currentType = 'interim';

                        // Show modal and setup tabs
                        const modal = document.getElementById('video-modal');
                        modal.style.display = 'block';

                        // Setup tab functionality
                        const tabs = document.querySelectorAll('.tab-button');
                        tabs.forEach(tab => {
                            tab.onclick = () => switchVideoTab(tab.dataset.videoType);
                        });

                        // Initially show interim video or final if interim doesn't exist
                        const initialType = currentVideoData.interimUrl ? 'interim' : 'final';
                        switchVideoTab(initialType);

                        // Hide tabs that don't have videos
                        if (!currentVideoData.interimUrl) {
                            document.querySelector('[data-video-type="interim"]').style.display = 'none';
                        } else {
                            document.querySelector('[data-video-type="interim"]').style.display = 'block';
                        }

                        if (!currentVideoData.finalUrl) {
                            document.querySelector('[data-video-type="final"]').style.display = 'none';
                        } else {
                            document.querySelector('[data-video-type="final"]').style.display = 'block';
                        }
                    };
                });
            }

            document.getElementById("close-modal").onclick = () => {
                document.getElementById("video-modal").style.display = "none";
                document.getElementById("video-frame").src = "";
            };


            /* ------------------------- ì—°ë„ ì„ íƒ ë©”ë‰´ ------------------------- */
            function setupArchiveMenu() {
                const btn = document.getElementById("archive-button");
                const dropdown = document.getElementById("archive-dropdown");
                const label = document.querySelector(".archive-label");

                btn.onclick = e => {
                    e.stopPropagation();
                    btn.classList.toggle("active");
                    dropdown.classList.toggle("open");
                };

                document.querySelectorAll(".archive-option").forEach(opt => {
                    opt.onclick = () => {
                        label.textContent = opt.dataset.year;

                        document
                            .querySelector(".archive-option.active")
                            ?.classList.remove("active");

                        opt.classList.add("active");
                        btn.classList.remove("active");
                        dropdown.classList.remove("open");

                        generateTeamCards(opt.dataset.year);
                    };
                });

                document.onclick = e => {
                    if (!btn.contains(e.target)) {
                        btn.classList.remove("active");
                        dropdown.classList.remove("open");
                    }
                };
            }

            /* -------------------------- ì´ˆê¸° ì‹¤í–‰ -------------------------- */
            setupArchiveMenu();
            generateTeamCards("2025");
        }
    </script>

    <!-- WebGL Shader (ì›ë³¸ ìœ ì§€) -->
    <script>
        const canvas = document.getElementById("glCanvas");
        const gl = canvas.getContext("webgl");

        function resize() {
            canvas.width = innerWidth;
            canvas.height = innerHeight;
            gl.viewport(0, 0, canvas.width, canvas.height);
        }
        addEventListener("resize", resize);
        resize();

        const vsSource = `attribute vec4 a_position; void main(){gl_Position=a_position;}`;
        const fsSource = `
            precision mediump float;
            uniform vec2 u_resolution;
            uniform float u_time;
            void main(){
                vec2 st = gl_FragCoord.xy / u_resolution;
                float t = u_time * 0.5;
                vec3 c = vec3(
                    0.5 + 0.5 * sin(st.x*3.0 + t),
                    0.3 + 0.3 * sin(st.y*3.0 - t),
                    0.2 + 0.5 * sin((st.x+st.y)*3.0 + t)
                );
                gl_FragColor = vec4(c, 1.0);
            }
        `;

        function shader(gl, type, src) {
            const s = gl.createShader(type);
            gl.shaderSource(s, src);
            gl.compileShader(s);
            return s;
        }

        const vs = shader(gl, gl.VERTEX_SHADER, vsSource);
        const fs = shader(gl, gl.FRAGMENT_SHADER, fsSource);
        const program = gl.createProgram();
        gl.attachShader(program, vs);
        gl.attachShader(program, fs);
        gl.linkProgram(program);
        gl.useProgram(program);

        const pos = gl.getAttribLocation(program, "a_position");
        const res = gl.getUniformLocation(program, "u_resolution");
        const time = gl.getUniformLocation(program, "u_time");

        const buf = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, buf);
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]),
            gl.STATIC_DRAW
        );

        gl.enableVertexAttribArray(pos);
        gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

        function loop(t) {
            gl.uniform2f(res, canvas.width, canvas.height);
            gl.uniform1f(time, t * 0.001);
            gl.drawArrays(gl.TRIANGLES, 0, 6);
            requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);
    </script>

</body>

</html>
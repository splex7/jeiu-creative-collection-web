<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="재능대학교 컴퓨터소프트웨어학과 졸업작품전">
    <meta name="description"
        content="재능대학교 컴퓨터소프트웨어학과 학생들의 창의적인 졸업작품을 소개합니다. 소프트웨어 개발, 웹, 모바일, 게임, AI 프로젝트까지 다양한 작품을 감상하세요.">
    <meta name="keywords" content="재능대학교, 컴퓨터소프트웨어학과, 졸업작품전, 졸업전시회, 소프트웨어 개발, 웹 개발, 모바일 앱, 게임 개발, AI 프로젝트, 포트폴리오, 전시회">
    <meta name="author" content="재능대학교 컴퓨터소프트웨어학과">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="재능대학교 컴퓨터소프트웨어학과 졸업작품전">
    <meta property="og:description" content="재능대학교 컴퓨터소프트웨어학과 학생들의 소프트웨어·웹·모바일·AI 작품을 한눈에 확인하세요.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jeiu.cc">
    <meta property="og:image" content="https://jeiu.cc/thumbnail.jpg">
    <meta property="og:site_name" content="재능대학교 컴퓨터소프트웨어학과 졸업작품전">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="재능대학교 컴퓨터소프트웨어학과 졸업작품전">
    <meta name="twitter:description" content="재능대학교 컴퓨터소프트웨어학과 졸업작품을 만나보세요.">
    <meta name="twitter:image" content="https://jeiu.cc/thumbnail.jpg">
    <link rel="canonical" href="https://jeiu.cc">
    <meta name="theme-color" content="#5A4FCF">



    <title>JEIU Creative Collection</title>

    <!-- Flicking CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@egjs/flicking@4.11.3/dist/flicking.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="styles.css">
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <script>
        // Firebase 초기화
        const firebaseConfig = {
            apiKey: "AIzaSyD7yIunudoV4htLvh7K4zSKXibRM4oquUw",
            authDomain: "dailyprincess-6c2c2.firebaseapp.com",
            databaseURL: "https://dailyprincess-6c2c2.firebaseio.com",
            projectId: "dailyprincess-6c2c2",
            storageBucket: "dailyprincess-6c2c2.firebasestorage.app",
            messagingSenderId: "953948313357",
            appId: "1:953948313357:web:80d229c82c94edc31b4244"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Define startApp immediately to prevent race condition
        let startAppCalled = false;
        function startApp() {
            if (startAppCalled) return;
            startAppCalled = true;

            /* ------------------------------------------------------------
                Flicking 초기화 (Flicking 로드 이후이므로 eg 100% 존재)
            ------------------------------------------------------------- */
            function initFlicking() {
                document.querySelectorAll(".team-carousel").forEach(carousel => {
                    if (carousel._flickingInstance) return;

                    const flick = new Flicking(carousel, {
                        align: "prev",
                        moveType: "snap",
                        gap: 10,
                        adaptive: true,
                        bound: true,
                        panelsPerView: 2.5,
                        defaultIndex: 1,
                    });

                    carousel._flickingInstance = flick;
                });
            }


            /* ------------------------ 학생 JSON 로드 ------------------------ */
            async function loadStudentData() {
                try {
                    const res = await fetch("students.json");
                    return await res.json();
                } catch {
                    return {};
                }
            }

            /* ------------------------ 프로젝트 JSON 로드 ------------------------ */
            async function loadProjectData(studentData, year) {
                try {
                    const res = await fetch("data.json");
                    const data = await res.json();

                    let all = [];

                    Object.entries(data).forEach(([className, list]) => {
                        list.forEach(team => {
                            const members = team["조원"].map(n => ({
                                name: n,
                                img: (studentData[n]?.img) ??
                                    "https://via.placeholder.com/100/444444/FFFFFF?text=?"
                            }));

                            // id에서 반 정보 추출 (team_a_01 -> A반, team_b_01 -> B반)
                            const classType = team.id.includes('team_a_') ? 'A반' : 'B반';

                            all.push({
                                id: team.id,
                                title: team["조이름"],
                                description: team["작품설명"],
                                platform: team["예상플랫폼"],
                                presentationVideo: team["중간발표영상"],
                                finalPresentationVideo: team["최종발표영상"],
                                presenters: team["최종발표자"],
                                teamMembersWithImages: members,
                                class: classType,
                                deploymentUrl: team["최종배포 URL"] || "",
                                interimDocUrl: team["중간발표자료"] || "",
                                finalDocUrl: team["최종발표자료"] || "",
                                year
                            });
                        });
                    });

                    return all;
                } catch {
                    return [];
                }
            }

            /* ----------------------------- 팀 카드 생성 ----------------------------- */
            async function generateTeamCards(year) {

                const grid = document.getElementById("project-grid");
                grid.innerHTML = "";

                const students = await loadStudentData();
                const projects = await loadProjectData(students, year);

                projects.forEach(p => {
                    const card = document.createElement("div");
                    card.className = "card";

                    card.innerHTML = `
                        <div class="card-image" data-card-id="${p.id}">
                            <img src="img/${p.id}.png" onerror="this.src='img/${p.id}.jpg'; this.onerror=function(){this.src='img/example.webp'; this.onerror=function(){this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg,#ff4d00,#ff8c00)';};};">
                            <img src="img/${p.id}r.jpg" onerror="this.style.display='none';" class="kenburns-image">
                            <div class="heart-count">
                                <span>❤️ <span class="heart-number">0</span></span>
                            </div>
                        </div>

                        <div class="card-content">
                            <div class="card-title-row">
                                <h3 class="card-title">${p.title}</h3>
                                <div class="card-badges">
                                    <div class="card-badge">${p.platform}</div>
                                    <div class="card-badge class-badge">${p.class}</div>
                                </div>
                            </div>

                            <div class="card-team-members">
                                <div class="team-carousel flicking-viewport">
                                    <div class="flicking-camera">
                                        ${p.teamMembersWithImages.map(m => `
                                            <div class="flicking-panel carousel-panel">
                                                <div class="member-avatar">
                                                    <img src="${m.img}" onerror="this.src='https://via.placeholder.com/100/444444/FFFFFF?text=?'">
                                                </div>
                                                <div class="member-name">${m.name}</div>
                                            </div>
                                        `).join("")}
                                    </div>
                                </div>
                            </div>

                            <p class="card-description">${p.description}</p>
                            <div class="card-links">
                                ${(p.presentationVideo || p.finalPresentationVideo) ? `<a href="#" class="embed-video card-link" data-interim-url="${p.presentationVideo || ''}" data-final-url="${p.finalPresentationVideo || ''}" data-interim-doc-url="${p.interimDocUrl}" data-final-doc-url="${p.finalDocUrl}" data-title="${p.title}">영상 보기</a>` : ""}
                                ${p.deploymentUrl ? `<a href="${p.deploymentUrl}" target="_blank" rel="noopener" class="card-link deployment-link">바로가기</a>` : ""}
                            </div>
                        </div>
                    `;

                    grid.appendChild(card);
                });

                // 카드 셔플 (모든 append 완료 후)
                const cards = Array.from(grid.children);
                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    grid.appendChild(cards[j]);
                }

                initFlicking();
                setupVideoButtons();
                setupHeartClickListeners();
                loadHeartCounts();
            }


            /* ------------------------- 유튜브 모달 ------------------------- */
            let currentVideoData = {
                interimUrl: '',
                finalUrl: '',
                currentType: 'interim',
                interimDocUrl: '',
                finalDocUrl: ''
            };

            function extractVideoId(url) {
                const reg = /^.*(youtu.be\/|v\/|embed\/|watch\?v=)([^#&?]*).*/;
                const m = url.match(reg);
                return m && m[2]?.length === 11 ? m[2] : null;
            }

            function switchVideoTab(type) {
                const tabs = document.querySelectorAll('.tab-button');
                const modal = document.getElementById('video-modal');
                const videoFrame = document.getElementById('video-frame');
                const docLink = document.getElementById('doc-link');
                const docButtonContainer = document.querySelector('.doc-button-container');

                // Update tab active states
                tabs.forEach(tab => {
                    if (tab.dataset.videoType === type) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });

                // Update current type and load video
                currentVideoData.currentType = type;
                const videoUrl = type === 'interim' ? currentVideoData.interimUrl : currentVideoData.finalUrl;
                const docUrl = type === 'interim' ? currentVideoData.interimDocUrl : currentVideoData.finalDocUrl;

                // Load video
                if (videoUrl) {
                    const videoId = extractVideoId(videoUrl);
                    if (videoId) {
                        videoFrame.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                        videoFrame.style.display = 'block';
                    } else {
                        videoFrame.style.display = 'none';
                    }
                } else {
                    videoFrame.style.display = 'none';
                }

                // Handle document
                if (docUrl) {
                    docLink.href = docUrl;
                    docLink.textContent = type === 'interim' ? '중간발표자료 보기' : '최종발표자료 보기';
                    docLink.style.pointerEvents = 'auto';
                    docLink.style.opacity = '1';
                    docButtonContainer.style.display = 'block';
                } else {
                    docLink.textContent = type === 'interim' ? '중간발표자료 보기' : '최종발표자료 보기';
                    docLink.style.pointerEvents = 'none';
                    docLink.style.opacity = '0.5';
                    docButtonContainer.style.display = 'block';
                }
            }

            function setupVideoButtons() {
                document.querySelectorAll(".embed-video").forEach(btn => {
                    btn.onclick = e => {
                        e.preventDefault();

                        // Store video data
                        currentVideoData.interimUrl = btn.dataset.interimUrl;
                        currentVideoData.finalUrl = btn.dataset.finalUrl;
                        currentVideoData.interimDocUrl = btn.dataset.interimDocUrl || '';
                        currentVideoData.finalDocUrl = btn.dataset.finalDocUrl || '';

                        // Reset to interim tab initially
                        currentVideoData.currentType = 'interim';

                        // Show modal and setup tabs
                        const modal = document.getElementById('video-modal');
                        modal.style.display = 'block';

                        // Setup tab functionality
                        const tabs = document.querySelectorAll('.tab-button');
                        tabs.forEach(tab => {
                            tab.onclick = () => switchVideoTab(tab.dataset.videoType);
                        });

                        // Initially show interim video or final if interim doesn't exist
                        const initialType = currentVideoData.interimUrl ? 'interim' : 'final';
                        switchVideoTab(initialType);

                        // Hide tabs that don't have videos
                        if (!currentVideoData.interimUrl) {
                            document.querySelector('[data-video-type="interim"]').style.display = 'none';
                        } else {
                            document.querySelector('[data-video-type="interim"]').style.display = 'block';
                        }

                        if (!currentVideoData.finalUrl) {
                            document.querySelector('[data-video-type="final"]').style.display = 'none';
                        } else {
                            document.querySelector('[data-video-type="final"]').style.display = 'block';
                        }
                    };
                });
            }

            document.getElementById("close-modal").onclick = () => {
                document.getElementById("video-modal").style.display = "none";
                document.getElementById("video-frame").src = "";
            };

            /* ------------------------- 하트 기능 ------------------------- */
            let heartClickTimeouts = {};

            function createHeartAnimation(x, y) {
                const heart = document.createElement('div');
                heart.className = 'heart-animation';
                heart.innerHTML = '❤️';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                document.body.appendChild(heart);

                setTimeout(() => {
                    heart.remove();
                }, 1500);
            }

            /* -------------------------- Firebase 연결 확인 -------------------------- */
            let firebaseConnected = false;
            let heartFunctionsEnabled = false;

            function checkFirebaseConnection() {
                const statusElement = document.getElementById('firebase-status');
                const connectedRef = database.ref('.info/connected');
                
                connectedRef.on('value', (snapshot) => {
                    const connected = snapshot.val();
                    firebaseConnected = connected;
                    
                    if (connected) {
                        statusElement.textContent = 'connected';
                        statusElement.className = 'firebase-status connected';
                        
                        // 연결되면 하트 기능 활성화
                        if (!heartFunctionsEnabled) {
                            heartFunctionsEnabled = true;
                        }
                    } else {
                        statusElement.textContent = 'connecting...';
                        statusElement.className = 'firebase-status';
                    }
                });
            }

            async function incrementHeartCount(cardId) {
                if (!firebaseConnected || !heartFunctionsEnabled) {
                    return;
                }
                
                try {
                    const heartRef = database.ref(`hearts/${cardId}`);
                    
                    const snapshot = await heartRef.once('value');
                    const currentCount = snapshot.val() || 0;
                    const newCount = currentCount + 1;
                    
                    await heartRef.set(newCount);
                } catch (error) {
                    console.error('하트 카운트 증가 실패:', error);
                }
            }

            async function loadHeartCounts() {
                try {
                    const heartsRef = database.ref('hearts');
                    heartsRef.on('value', (snapshot) => {
                        const heartsData = snapshot.val() || {};
                        
                        document.querySelectorAll('.card-image').forEach(cardImage => {
                            const cardId = cardImage.dataset.cardId;
                            const heartNumber = cardImage.querySelector('.heart-number');
                            if (heartNumber) {
                                heartNumber.textContent = heartsData[cardId] || 0;
                            }
                        });
                    });
                } catch (error) {
                    console.error('하트 카운트 로드 실패:', error);
                }
            }

            function setupHeartClickListeners() {
                document.querySelectorAll('.card-image').forEach(cardImage => {
                    cardImage.addEventListener('click', function(e) {
                        const cardId = this.dataset.cardId;
                        
                        // 0.5초 연타 방지
                        if (heartClickTimeouts[cardId]) {
                            return;
                        }
                        
                        heartClickTimeouts[cardId] = true;
                        setTimeout(() => {
                            delete heartClickTimeouts[cardId];
                        }, 500);
                        
                        // 하트 애니메이션 생성 - 카드 내 상대 위치로 수정
                        const rect = this.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        
                        const heart = document.createElement('div');
                        heart.className = 'heart-animation';
                        heart.innerHTML = '❤️';
                        heart.style.left = x + 'px';
                        heart.style.top = y + 'px';
                        this.style.position = 'relative';
                        this.appendChild(heart);

                        setTimeout(() => {
                            heart.remove();
                        }, 1500);
                        
                        // 하트 카운트 증가
                        incrementHeartCount(cardId);
                    });
                });
            }


            /* ------------------------- 연도 선택 메뉴 ------------------------- */
            function setupArchiveMenu() {
                const btn = document.getElementById("archive-button");
                const dropdown = document.getElementById("archive-dropdown");
                const label = document.querySelector(".archive-label");

                btn.onclick = e => {
                    e.stopPropagation();
                    btn.classList.toggle("active");
                    dropdown.classList.toggle("open");
                };

                document.querySelectorAll(".archive-option").forEach(opt => {
                    opt.onclick = () => {
                        label.textContent = opt.dataset.year;

                        document
                            .querySelector(".archive-option.active")
                            ?.classList.remove("active");

                        opt.classList.add("active");
                        btn.classList.remove("active");
                        dropdown.classList.remove("open");

                        generateTeamCards(opt.dataset.year);
                    };
                });

                document.onclick = e => {
                    if (!btn.contains(e.target)) {
                        btn.classList.remove("active");
                        dropdown.classList.remove("open");
                    }
                };
            }

            /* -------------------------- 초기 실행 -------------------------- */
            setupArchiveMenu();
            generateTeamCards("2025");
            
            // Firebase 연결 확인 시작
            setTimeout(() => {
                checkFirebaseConnection();
            }, 1000);
        }

        const flickScript = document.createElement("script");
        flickScript.src = "/assets/js/flicking.pkgd.min.js";

        flickScript.onload = () => {
            console.log("Flicking loaded!");
            
            // Firebase가 준비될 때까지 기다렸다가 startApp 실행
            if (typeof firebase !== 'undefined' && firebase.database()) {
                console.log("Firebase ready!");
                startApp();
            } else {
                console.error("Firebase not loaded properly");
            }
        };

        document.head.appendChild(flickScript);
    </script>
</head>

<body>

    <!-- WebGL Canvas Background -->
    <div id="canvas-container">
        <canvas id="glCanvas"></canvas>
    </div>

    <!-- Grain Overlay -->
    <div class="noise-overlay"></div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-top">
                    <div class="archive-menu">
                        <div class="archive-selector">
                            <div class="archive-button" id="archive-button">
                                <span class="archive-label">2025</span>
                            </div>
                            <div class="archive-dropdown" id="archive-dropdown">
                                <div class="archive-option active" data-year="2025">2025</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="logo-container">
                    <img src="jeiu-logo.svg" class="jeiu-logo">
                </div>

                <span class="brand-tag">Creative Collection</span>
                <h2>Computer Software<br>Graduation Projects</h2>
                <p class="subtitle">
                    재능대학교 컴퓨터소프트웨어학과 졸업작품 아카이브.<br>
                    학생들의 열정과 기술이 담긴 프로젝트들을 영구히 기록합니다.
                </p>
            </div>
        </header>

        <section class="gallery-section">
            <div class="grid" id="project-grid"></div>
        </section>

        <!-- Modal -->
        <div id="video-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="close-modal">&times;</span>
                <div class="video-container">
                    <iframe id="video-frame" width="100%" height="400" allowfullscreen></iframe>
                </div>
                <div class="doc-button-container">
                    <a id="doc-link" href="#" target="_blank" rel="noopener" class="doc-button">발표자료 보기</a>
                </div>
                <div class="video-tabs" id="video-tabs">
                    <button class="tab-button active" data-video-type="interim">중간발표</button>
                    <button class="tab-button" data-video-type="final">최종발표</button>
                </div>
            </div>
        </div>

        <footer>
            <div class="footer-content">
                <p>&copy; 2025 JEIU University Computer Software Dept. All rights reserved.</p>
                <div class="footer-links">
                    <a href="https://www.jeiu.ac.kr" target="_blank" rel="noopener" class="backlink">
                        <span class="backlink-text">재능대학교 홈페이지</span>
                        <span class="backlink-url">jeiu.ac.kr</span>
                    </a>
                    <span id="firebase-status" class="firebase-status"></span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Shader Script -->
    <script src="shader.js"></script>
</body>

</html>
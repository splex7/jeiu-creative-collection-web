<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Cache Optimization -->
    <meta http-equiv="Cache-Control" content="public, max-age=31536000, immutable">
    <meta http-equiv="ETag" content="v1.0">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="styles.css" as="style">

    <!-- Preload Critical Images -->
    <link rel="preload" href="jeiu-logo.svg" as="image" type="image/svg+xml">
    <link rel="preload" href="faces/default.jpg" as="image">

    <!-- DNS Prefetch for External Resources -->
    <link rel="dns-prefetch" href="//www.gstatic.com">
    <link rel="dns-prefetch" href="//firebase.googleapis.com">
    <link rel="dns-prefetch" href="//www.jeiu.ac.kr">
    <link rel="dns-prefetch" href="//dept.jeiu.ac.kr">

    <!-- Preconnect for Critical External Resources -->
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://firebase.googleapis.com" crossorigin>

    <meta name="title" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíàÏ†Ñ">
    <meta name="description"
        content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º ÌïôÏÉùÎì§Ïùò Ï∞ΩÏùòÏ†ÅÏù∏ Ï°∏ÏóÖÏûëÌíàÏùÑ ÏÜåÍ∞úÌï©ÎãàÎã§. ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ Í∞úÎ∞ú, Ïõπ, Î™®Î∞îÏùº, Í≤åÏûÑ, AI ÌîÑÎ°úÏ†ùÌä∏ÍπåÏßÄ Îã§ÏñëÌïú ÏûëÌíàÏùÑ Í∞êÏÉÅÌïòÏÑ∏Ïöî.">
    <meta name="keywords" content="Ïû¨Îä•ÎåÄÌïôÍµê, Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º, Ï°∏ÏóÖÏûëÌíàÏ†Ñ, Ï°∏ÏóÖÏ†ÑÏãúÌöå, ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ Í∞úÎ∞ú, Ïõπ Í∞úÎ∞ú, Î™®Î∞îÏùº Ïï±, Í≤åÏûÑ Í∞úÎ∞ú, AI ÌîÑÎ°úÏ†ùÌä∏, Ìè¨Ìä∏Ìè¥Î¶¨Ïò§, Ï†ÑÏãúÌöå">
    <meta name="author" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíàÏ†Ñ">
    <meta property="og:description" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º ÌïôÏÉùÎì§Ïùò ÏÜåÌîÑÌä∏Ïõ®Ïñ¥¬∑Ïõπ¬∑Î™®Î∞îÏùº¬∑AI ÏûëÌíàÏùÑ ÌïúÎààÏóê ÌôïÏù∏ÌïòÏÑ∏Ïöî.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jeiu.cc">
    <meta property="og:image" content="https://jeiu.cc/thumbnail.jpg">
    <meta property="og:site_name" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíàÏ†Ñ">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíàÏ†Ñ">
    <meta name="twitter:description" content="Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíàÏùÑ ÎßåÎÇòÎ≥¥ÏÑ∏Ïöî.">
    <meta name="twitter:image" content="https://jeiu.cc/thumbnail.jpg">
    <link rel="canonical" href="https://jeiu.cc">
    <meta name="theme-color" content="#5A4FCF">
    

    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "JEIU Creative Collection",
      "url": "https://jeiu.cc/",
      "publisher": {
        "@type": "Organization",
        "name": "JEIU Creative Collection",
        "logo": {
          "@type": "ImageObject",
          "url": "https://jeiu.cc/logo.png"
        }
      }
    }
    </script>

    <title>JEIU Creative Collection</title>

    <!-- Flicking CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@egjs/flicking@4.11.3/dist/flicking.css">

    <!-- CSS Polyfills for Legacy Browser Support -->
    <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2.4.8/dist/css-vars-ponyfill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/picturefill@3.0.3/dist/picturefill.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="styles.css">
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <script>
        // Firebase Ï¥àÍ∏∞Ìôî
        const firebaseConfig = {
            apiKey: "AIzaSyD7yIunudoV4htLvh7K4zSKXibRM4oquUw",
            authDomain: "dailyprincess-6c2c2.firebaseapp.com",
            databaseURL: "https://dailyprincess-6c2c2.firebaseio.com",
            projectId: "dailyprincess-6c2c2",
            storageBucket: "dailyprincess-6c2c2.firebasestorage.app",
            messagingSenderId: "953948313357",
            appId: "1:953948313357:web:80d229c82c94edc31b4244"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Initialize CSS polyfills for legacy browsers (with error handling)
        try {
            if (typeof window.cssVars !== 'undefined') {
                cssVars({
                    watch: true,
                    onlyLegacy: false // Force polyfill for better compatibility
                });
            }
        } catch (e) {
            console.warn('CSS Variables polyfill failed:', e);
        }

        // Initialize picturefill for legacy browsers
        try {
            if (typeof window.picturefill !== 'undefined') {
                picturefill();
            }
        } catch (e) {
            console.warn('Picturefill polyfill failed:', e);
        }

        // Check for backdrop-filter support
        if (!CSS.supports('backdrop-filter', 'blur(10px)') && !CSS.supports('-webkit-backdrop-filter', 'blur(10px)')) {
            document.documentElement.classList.add('no-backdropfilter');
        }

        // Browser detection and fallbacks
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            const isIE = userAgent.indexOf('MSIE') !== -1 || userAgent.indexOf('Trident/') !== -1;
            const isOldIE = userAgent.indexOf('MSIE') !== -1;
            const isFirefox = userAgent.indexOf('Firefox') !== -1;
            const isChrome = userAgent.indexOf('Chrome') !== -1;
            const isSafari = userAgent.indexOf('Safari') !== -1 && !isChrome;

            return {
                isIE: isIE,
                isOldIE: isOldIE,
                isFirefox: isFirefox,
                isChrome: isChrome,
                isSafari: isSafari,
                version: getBrowserVersion(userAgent)
            };
        }

        function getBrowserVersion(userAgent) {
            let match = userAgent.match(/(MSIE |rv:|Chrome\/|Firefox\/|Safari\/)(\d+)/);
            return match ? parseInt(match[2]) : 0;
        }

        // Apply browser-specific fixes
        function applyBrowserFixes() {
            const browser = detectBrowser();

            // Add IE class to html
            if (browser.isIE) {
                document.documentElement.className += ' ie';
                if (browser.isOldIE) {
                    document.documentElement.className += ' lt-ie9';
                }
            }

            // Fix for old browsers that don't support flexbox
            if (browser.version < 30 || browser.isOldIE) {
                document.documentElement.className += ' no-flexbox';
                // Apply no-flexbox fallbacks

                // Fallback for comment and heart buttons
                setTimeout(() => {
                    applyFlexboxFallbacks();
                }, 1000);
            }

            // Browser detection complete
        }

        // Apply flexbox fallbacks for old browsers
        function applyFlexboxFallbacks() {
            const browser = detectBrowser();

            // Fallback for comment buttons
            document.querySelectorAll('.comment-count').forEach(btn => {
                // Check if flexbox is not supported
                if (!CSS.supports('display', 'flex') || browser.isOldIE || browser.version < 30) {
                    // Apply flexbox fallback to comment button

                    // Force inline display for old browsers
                    btn.style.display = 'inline';
                    btn.style.position = 'absolute';
                    btn.style.top = '10px';
                    btn.style.right = '10px';
                    btn.style.background = '#000';
                    btn.style.color = '#fff';
                    btn.style.padding = '4px 8px';
                    btn.style.border = '2px solid #fff';
                    btn.style.textDecoration = 'none';
                    btn.style.zIndex = '10';
                    btn.style.fontSize = '12px';
                    btn.style.fontWeight = 'bold';

                    // Remove flexbox properties
                    btn.style.alignItems = '';
                    btn.style.gap = '';

                    // Handle child elements
                    const span = btn.querySelector('span');
                    if (span) {
                        span.style.display = 'inline';
                        span.style.verticalAlign = 'middle';
                        span.style.alignItems = '';
                    }
                }

                // IE8 specific fallbacks
                if (browser.isOldIE && btn.currentStyle) {
                    // Apply IE8 specific fallbacks
                    btn.style.display = 'inline';
                    btn.style.zoom = '1';
                    btn.style.background = '#000';
                    btn.style.border = '2px solid #fff';
                    btn.style.color = '#fff';
                    btn.style.padding = '2px 6px';
                    btn.style.textDecoration = 'none';
                    btn.style.borderRadius = '0';
                }
            });

            // Fallback for heart buttons
            document.querySelectorAll('.heart-count').forEach(btn => {
                if (!CSS.supports('display', 'flex') || browser.isOldIE || browser.version < 30) {
                    // Apply flexbox fallback to heart button

                    btn.style.display = 'inline';
                    btn.style.position = 'absolute';
                    btn.style.top = '10px';
                    btn.style.left = '10px';
                    btn.style.background = '#000';
                    btn.style.color = '#fff';
                    btn.style.padding = '4px 8px';
                    btn.style.border = '2px solid #fff';
                    btn.style.textDecoration = 'none';
                    btn.style.zIndex = '10';
                    btn.style.fontSize = '12px';
                    btn.style.fontWeight = 'bold';

                    // Handle child elements
                    const span = btn.querySelector('span');
                    if (span) {
                        span.style.display = 'inline';
                        span.style.verticalAlign = 'middle';
                        span.style.alignItems = '';
                    }
                }

                // IE8 specific fallbacks
                if (browser.isOldIE && btn.currentStyle) {
                    btn.style.display = 'inline';
                    btn.style.zoom = '1';
                    btn.style.background = '#000';
                    btn.style.border = '2px solid #fff';
                    btn.style.color = '#fff';
                    btn.style.padding = '2px 6px';
                    btn.style.textDecoration = 'none';
                    btn.style.borderRadius = '0';
                }
            });

            // Flexbox fallbacks applied
        }

        // Test comment button visibility
        function testCommentButtonVisibility() {
            const commentBtn = document.querySelector('.comment-count');
            if (commentBtn) {
                const styles = window.getComputedStyle ? window.getComputedStyle(commentBtn) : commentBtn.currentStyle;
                const isVisible = styles.display !== 'none' && styles.visibility !== 'hidden';

                if (!isVisible) {
                    // console.warn('Comment button may not be visible in this browser');
                    // Apply emergency fallback
                    commentBtn.style.display = 'inline';
                    commentBtn.style.position = 'absolute';
                    commentBtn.style.top = '10px';
                    commentBtn.style.right = '10px';
                    commentBtn.style.background = '#000';
                    commentBtn.style.color = '#fff';
                    commentBtn.style.padding = '4px 8px';
                    commentBtn.style.border = '2px solid #fff';
                    commentBtn.style.zIndex = '10';
                }
            }
        }

        // Define startApp immediately to prevent race condition
        let startAppCalled = false;
        function startApp() {
            if (startAppCalled) return;
            startAppCalled = true;

            // Apply browser fixes immediately
            applyBrowserFixes();

            // Loading indicator management
            const loadingIndicator = document.getElementById('loading-indicator');
            let loadingProgress = 0;
            
            function updateLoadingProgress(progress) {
                const progressBar = loadingIndicator.querySelector('.progress-bar');
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
            }
            
            function hideLoadingIndicator() {
                if (loadingIndicator) {
                    loadingIndicator.classList.add('hidden');
                    setTimeout(() => {
                        loadingIndicator.style.display = 'none';
                    }, 500);
                }
            }
            
            // Simulate loading progress
            let loadingInterval = setInterval(() => {
                loadingProgress += Math.random() * 15;
                if (loadingProgress > 90) {
                    loadingProgress = 90;
                    clearInterval(loadingInterval);
                }
                updateLoadingProgress(loadingProgress);
            }, 300);

            // JEIU Developer Console Message
            console.log('%cüéì JEIU Creative Collection - Developer Console üéì',
                'font-size: 16px; font-weight: bold; color: #ff4d00; background: #fff; padding: 10px; border-radius: 5px; border: 2px solid #ff4d00;');

            // JEIU ASCII Art (Improved Readability)
            console.log('%c      ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó',
                'font-size: 12px; color: #ff4d00; font-weight: bold; font-family: monospace;');
            console.log('%c      ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë',
                'font-size: 12px; color: #ff4d00; font-weight: bold; font-family: monospace;');
            console.log('%c      ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë',
                'font-size: 12px; color: #ff4d00; font-weight: bold; font-family: monospace;');
            console.log('%c ‚ñà‚ñà   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë',
                'font-size: 12px; color: #ff4d00; font-weight: bold; font-family: monospace;');
            console.log('%c ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù',
                'font-size: 12px; color: #ff4d00; font-weight: bold; font-family: monospace;');
            console.log('%c  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ',
                'font-size: 12px; color: #ff4d00; font-weight: bold; font-family: monospace;');
            // Graduation Message (keep this)
            console.log('%cÏû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíàÏ†Ñ',
                'font-size: 14px; color: #666; font-style: italic;');
            // Additional friendly messages (keep these)
            console.log('%cüëã ÏïàÎÖïÌïòÏÑ∏Ïöî, Í∞úÎ∞úÏûê ÎèôÎ£å! üëã',
                'font-size: 12px; color: #ff8c00; font-weight: bold;');
            console.log('%cÏù¥ ÌîÑÎ°úÏ†ùÌä∏Ïóê ÎåÄÌïú ÏßàÎ¨∏Ïù¥ÎÇò Ï†úÏïàÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì†ÏßÄ Ïó∞ÎùΩÏ£ºÏÑ∏Ïöî!',
                'font-size: 11px; color: #888;');
            console.log('%cüöÄ Ìï®Íªò ÏÑ±Ïû•ÌïòÎäî Í∞úÎ∞úÏûê Ïª§ÎÆ§ÎãàÌã∞Î•º ÏùëÏõêÌï©ÎãàÎã§! üöÄ',
                'font-size: 11px; color: #ff4d00; font-weight: bold;');

            /* ------------------------------------------------------------
                Flicking Ï¥àÍ∏∞Ìôî (Flicking Î°úÎìú Ïù¥ÌõÑÏù¥ÎØÄÎ°ú eg 100% Ï°¥Ïû¨)
            ------------------------------------------------------------- */
            function initFlicking() {
                document.querySelectorAll(".team-carousel").forEach(carousel => {
                    if (carousel._flickingInstance) return;

                    const flick = new Flicking(carousel, {
                        align: "prev",
                        moveType: "snap",
                        gap: 10,
                        adaptive: true,
                        bound: true,
                        panelsPerView: 3.5,
                        defaultIndex: 0,
                        preventDefault: "false"
                    });

                    // Flicking Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
                    flick.on("moveStart", () => {
                        hideSpeechBubble();
                    });

                    carousel._flickingInstance = flick;
                });
            }


            /* ------------------------ ÌïôÏÉù JSON Î°úÎìú ------------------------ */
            async function loadStudentData() {
                try {
                    const res = await fetch("students.json");
                    return await res.json();
                } catch {
                    return {};
                }
            }

            /* ------------------------ ÌîÑÎ°úÏ†ùÌä∏ JSON Î°úÎìú ------------------------ */
            async function loadProjectData(studentData, year) {
                try {
                    const res = await fetch("data.json");
                    const data = await res.json();

                    let all = [];

                    // ÌåÄ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                    teamData = {};
                    ['aÎ∞ò', 'bÎ∞ò'].forEach(className => {
                        if (data[className]) {
                            data[className].forEach(team => {
                                teamData[team.id] = team["Ï°∞Ïù¥Î¶Ñ"] || team.id;
                            });
                        }
                    });

                    // console.log('Team data loaded:', teamData);

                    Object.entries(data).forEach(([className, list]) => {
                        list.forEach(team => {
                            const members = team["Ï°∞Ïõê"].map(n => ({
                                name: n,
                                img: (studentData[n]?.img) ??
                                    "https://via.placeholder.com/100/444444/FFFFFF?text=?"
                            }));

                            // idÏóêÏÑú Î∞ò Ï†ïÎ≥¥ Ï∂îÏ∂ú (team_a_01 -> AÎ∞ò, team_b_01 -> BÎ∞ò)
                            const classType = team.id.includes('team_a_') ? 'AÎ∞ò' : 'BÎ∞ò';

                            all.push({
                                id: team.id,
                                title: team["Ï°∞Ïù¥Î¶Ñ"],
                                description: team["ÏûëÌíàÏÑ§Î™Ö"],
                                platform: team["ÏòàÏÉÅÌîåÎû´Ìèº"],
                                presentationVideo: team["Ï§ëÍ∞ÑÎ∞úÌëúÏòÅÏÉÅ"],
                                finalPresentationVideo: team["ÏµúÏ¢ÖÎ∞úÌëúÏòÅÏÉÅ"],
                                presenters: team["ÏµúÏ¢ÖÎ∞úÌëúÏûê"],
                                teamMembersWithImages: members,
                                class: classType,
                                deploymentUrl: team["ÏµúÏ¢ÖÎ∞∞Ìè¨ URL"] || "",
                                interimDocUrl: team["Ï§ëÍ∞ÑÎ∞úÌëúÏûêÎ£å"] || "",
                                finalDocUrl: team["ÏµúÏ¢ÖÎ∞úÌëúÏûêÎ£å"] || "",
                                year
                            });
                        });
                    });

                    return all;
                } catch {
                    return [];
                }
            }

            // Global variable to store current projects
            let currentProjects = [];

            /* ----------------------------- ÌåÄ Ïπ¥Îìú ÏÉùÏÑ± ----------------------------- */
            async function generateTeamCards(year) {

                const grid = document.getElementById("project-grid");
                grid.innerHTML = "";

                const students = await loadStudentData();
                const projects = await loadProjectData(students, year);

                // Store projects globally for shuffling
                currentProjects = projects;

                renderProjects(projects);
            }

            // Function to render projects
            function renderProjects(projects) {
                const grid = document.getElementById("project-grid");
                grid.innerHTML = "";

                projects.forEach(p => {
                    const card = document.createElement("div");
                    card.className = "card";

                    card.innerHTML = `
                        <div class="card-image" data-card-id="${p.id}">
                            <img src="img/${p.id}.png" decoding="async" onerror="this.src='img/${p.id}.jpg'; this.onerror=function(){this.src='img/example.webp'; this.onerror=function(){this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg,#ff4d00,#ff8c00)';};};">
                            <img data-src="img/${p.id}r.jpg" decoding="async" onerror="this.style.display='none';" class="kenburns-image lazy-image">
                            
                            <!-- Ï¢åÏ∏° ÌïòÌä∏ Î≤ÑÌäº -->
                            <div class="heart-count">
                                <span>‚ù§Ô∏è <span class="heart-number">0</span></span>
                            </div>
                            
                            <!-- Ïö∞Ï∏° ÎåìÍ∏Ä Î≤ÑÌäº -->
                            <div class="comment-count" data-card-id="${p.id}">
                                <span>üí¨ <span class="comment-number">0</span></span>
                            </div>
                        </div>

                        <div class="card-content">
                            <div class="card-title-row">
                                <h3 class="card-title">${p.title}</h3>
                                <div class="card-badges">
                                    <div class="card-badge">${p.platform}</div>
                                    <div class="card-badge class-badge">${p.class}</div>
                                </div>
                            </div>

                            <div class="card-team-members">
                                <div class="team-carousel flicking-viewport">
                                    <div class="flicking-camera">
                                        ${p.teamMembersWithImages.map(m => `
                                            <div class="flicking-panel carousel-panel">
                                                <div class="member-avatar">
                                                    <img src="${m.img}" decoding="async" onerror="this.src='https://via.placeholder.com/100/444444/FFFFFF?text=?'">
                                                </div>
                                                <div class="member-name">${m.name}</div>
                                            </div>
                                        `).join("")}
                                    </div>
                                </div>
                            </div>

                            <p class="card-description">${p.description}</p>
                            <div class="card-links">
                                ${(p.presentationVideo || p.finalPresentationVideo) ? `<a href="#" class="embed-video card-link" data-interim-url="${p.presentationVideo || ''}" data-final-url="${p.finalPresentationVideo || ''}" data-interim-doc-url="${p.interimDocUrl}" data-final-doc-url="${p.finalDocUrl}" data-title="${p.title}">ÏòÅÏÉÅ Î≥¥Í∏∞</a>` : ""}
                                ${p.deploymentUrl ? `<a href="${p.deploymentUrl}" target="_blank" rel="noopener" class="card-link deployment-link">Î∞îÎ°úÍ∞ÄÍ∏∞</a>` : ""}
                            </div>
                        </div>
                    `;

                    grid.appendChild(card);
                });

                // Ïπ¥Îìú ÏÖîÌîå (Î™®Îì† append ÏôÑÎ£å ÌõÑ)
                const cards = Array.from(grid.children);
                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    grid.appendChild(cards[j]);
                }

                initFlicking();
                setupVideoButtons();
                setupHeartClickListeners();
                loadHeartCounts();
                setupStudentSpeechBubbles();
                setupExhibitionVideo();
                setupFieldVideo();
                setupShuffleButton();
                setupQRContainer();
                setupCommentButtonListeners();
                initializeCommentCounts();
                setupCommentModal();
                initializeCacheOptimization(); // Add cache optimization

                // Test comment button visibility after rendering
                setTimeout(() => {
                    testCommentButtonVisibility();
                }, 500);
            }

            // Shuffle function
            function shuffleProjects() {
                if (currentProjects.length === 0) return;

                const grid = document.getElementById("project-grid");

                // Fade out animation
                grid.classList.add('shuffle-fade-out');

                setTimeout(() => {
                    // Shuffle the projects array
                    const shuffled = [...currentProjects];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }

                    // Update global variable and re-render
                    currentProjects = shuffled;
                    renderProjects(currentProjects);

                    // Fade in animation
                    grid.classList.remove('shuffle-fade-out');
                    grid.classList.add('shuffle-fade-in');

                    setTimeout(() => {
                        grid.classList.remove('shuffle-fade-in');
                    }, 500);
                }, 300);
            }

            // Setup shuffle button
            function setupShuffleButton() {
                const shuffleBtn = document.getElementById('shuffle-cards-btn');
                if (shuffleBtn) {
                    shuffleBtn.addEventListener('click', shuffleProjects);
                }
            }

            // Setup QR container toggle functionality
            function setupQRContainer() {
                const qrContainer = document.querySelector('.qr-code-container');
                if (!qrContainer) return;

                let isMinimized = false;

                qrContainer.addEventListener('click', function (e) {
                    // Prevent event bubbling to avoid interfering with other interactions
                    e.stopPropagation();

                    isMinimized = !isMinimized;

                    if (isMinimized) {
                        this.classList.add('minimized');
                    } else {
                        this.classList.remove('minimized');
                    }
                });

                // Optional: Add keyboard support (Escape to minimize, Enter to restore)
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape' && qrContainer && !qrContainer.classList.contains('minimized')) {
                        qrContainer.classList.add('minimized');
                        isMinimized = true;
                    } else if (e.key === 'Enter' && qrContainer && qrContainer.classList.contains('minimized') && document.activeElement === qrContainer) {
                        qrContainer.classList.remove('minimized');
                        isMinimized = false;
                    }
                });
            }

            // Comment system variables
            let currentCommentCardId = null;

            // Setup comment button listeners
            function setupCommentButtonListeners() {
                document.querySelectorAll('.comment-count').forEach(commentBtn => {
                    commentBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        const cardId = this.dataset.cardId;
                        openCommentModal(cardId);
                    });
                });
            }

            // Parse name and affiliation from text like "ÍπÄÏ≤†Ïàò(ÍµêÏàò)" or "ÌôçÍ∏∏Îèô[Í∞úÎ∞úÏûê][ÌåÄÏû•]"
            function parseNameAndAffiliation(fullName) {
                let name = fullName;
                let affiliation = null;
                let specialTags = [];

                // Extract ALL parentheses content first
                const parentheticalRegex = /\(([^)]+)\)/g;
                const parentheticalMatches = [...fullName.matchAll(parentheticalRegex)];
                
                if (parentheticalMatches.length > 0) {
                    // Remove all parenthetical content from name
                    name = fullName.replace(parentheticalRegex, '').trim();
                    
                    // Process each parenthetical content
                    parentheticalMatches.forEach(match => {
                        const content = match[1].trim();
                        
                        // Skip if content starts with 'Ï£º' (company indicator)
                        if (content.startsWith('Ï£º')) {
                            // Don't add as tag, just skip it
                            return;
                        }
                        
                        // Add as special tag for all other parenthetical content
                        specialTags.push({
                            text: escapeHtml(content),
                            type: 'parenthesis'
                        });
                    });
                }

                // Extract ALL square brackets content
                const bracketRegex = /\[([^\]]+)\]/g;
                const bracketMatches = [...fullName.matchAll(bracketRegex)];
                
                if (bracketMatches.length > 0) {
                    // Remove all bracket content from name if not already removed
                    if (!parentheticalMatches.length) {
                        name = fullName.replace(bracketRegex, '').trim();
                    }
                    
                    // Process each bracket content
                    bracketMatches.forEach(match => {
                        const content = match[1].trim();
                        
                        // Skip if bracket content contains '(Ï£º)' (company indicator)
                        if (content.includes('(Ï£º)')) {
                            // Don't add as tag, just skip it
                            return;
                        }
                        
                        // Add as special tag for all other bracket content
                        specialTags.push({
                            text: escapeHtml(content),
                            type: 'bracket'
                        });
                    });
                }

                return {
                    name: escapeHtml(name.trim() || fullName),
                    affiliation: null, // No more special affiliation - everything is a tag
                    specialTags: specialTags
                };
            }

            // Get team name from card ID
            function getTeamName(cardId) {
                // Map card IDs to actual team names from data.json
                const teamNames = {
                    'team_a_01': 'ÏΩîÏ∞∏Ïûò',
                    'team_a_02': 'Îπ†ÌÖê',
                    'team_a_03': 'AIÌï¥Ï°∞',
                    'team_a_04': 'Î°úÏºìÎã®',
                    'team_a_05': '1400Ï°∞',
                    'team_b_06': 'Î∏åÎ†àÏù∏Ìïè',
                    'team_b_07': 'ÌòºÏ≤ú',
                    'team_b_08': 'ÏÑ∏ÏñºÍ∞ÑÏù¥',
                    'team_b_09': 'Ïû°ÏïòÏ°∞',
                    'team_b_10': '1Ï°∞ÎãµÍ≤å'
                };

                return teamNames[cardId] || cardId;
            }

            // Open comment modal
            function openCommentModal(cardId) {
                currentCommentCardId = cardId;
                const modal = document.getElementById('comment-modal');
                const titleElement = document.getElementById('comment-modal-title');

                // Update modal title with team name
                const teamName = getTeamName(cardId);
                titleElement.textContent = `üí¨ ${teamName}`;

                modal.style.display = 'block';
                loadComments(cardId);

                // Restore saved name if exists
                const savedName = localStorage.getItem('currentCommentName');
                if (savedName) {
                    document.getElementById('comment-name').value = savedName;
                }

                // Clear text input
                document.getElementById('comment-text').value = '';

                // Refresh display after a short delay to ensure name field is considered
                setTimeout(() => {
                    loadComments(cardId);
                }, 100);
            }

            // Close comment modal
            function closeCommentModal() {
                const modal = document.getElementById('comment-modal');
                modal.style.display = 'none';
                currentCommentCardId = null;

                // Clean up comments polling
                if (window.currentCommentsInterval) {
                    clearInterval(window.currentCommentsInterval);
                    window.currentCommentsInterval = null;
                }
            }

            // Load comments from D1 API
            function loadComments(cardId) {
                // Use cardId as teamId since each team has one card
                const teamId = cardId;
                // 
                // console.log(`Loading comments for card ${cardId}, teamId: ${teamId}`);

                if (!teamId) {
                    console.warn(`No team ID found for card ${cardId}`);
                    return;
                }

                // Clear comments immediately to prevent old comments from showing
                const commentList = document.getElementById('comment-list');
                if (commentList) {
                    commentList.innerHTML = '<div class="no-comments">Î°úÎî© Ï§ë...</div>';
                }

                // Clean up previous listener if exists
                if (window.currentCommentsInterval) {
                    clearInterval(window.currentCommentsInterval);
                    window.currentCommentsInterval = null;
                }

                // Load comments from D1 API
                loadCommentsFromD1(teamId);

                // Set up polling for real-time updates (every 5 seconds)
                window.currentCommentsInterval = setInterval(() => {
                    loadCommentsFromD1(teamId);
                }, 5000);
            }

            // Load comments from D1 API
            function loadCommentsFromD1(teamId) {
                fetch(`https://jeiu.cc/api/comments?teamId=${encodeURIComponent(teamId)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        const comments = {};
                        if (data.comments && Array.isArray(data.comments)) {
                            data.comments.forEach(comment => {
                                comments[comment.id] = comment;
                            });
                        }
                        console.log('Comments updated from D1:', Object.keys(comments).length, 'comments found');
                        displayComments(comments);
                    })
                    .catch(error => {
                        console.error('Error loading comments from D1:', error);
                        const commentList = document.getElementById('comment-list');
                        if (commentList) {
                            commentList.innerHTML = '<div class="no-comments">ÎåìÍ∏ÄÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.</div>';
                        }
                    });
            }

            // Display comments in the modal
            function displayComments(comments) {
                const commentList = document.getElementById('comment-list');

                // Filter out soft-deleted comments
                const activeComments = {};
                Object.entries(comments).forEach(([commentId, comment]) => {
                    // Only show comments that are not soft-deleted
                    if (!comment.deleted) {
                        activeComments[commentId] = comment;
                    }
                });

                const commentArray = Object.entries(activeComments).sort((a, b) => b[1].timestamp - a[1].timestamp);

                if (commentArray.length === 0) {
                    commentList.innerHTML = '<div class="no-comments">ÏïÑÏßÅ ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§. Îî∞ÎìØÌïú ÏùëÏõêÏùò ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî!</div>';
                    return;
                }

                commentList.innerHTML = commentArray.map(([commentId, comment]) => {
                    const isOwn = isOwnComment(comment);
                    const deleteButton = isOwn ? `<button class="delete-comment-btn" onclick="deleteComment('${currentCommentCardId}', '${commentId}')">üóëÔ∏è</button>` : '';

                    // Parse name and special tags (no more affiliation)
                    const parsedName = parseNameAndAffiliation(comment.name || 'ÏùµÎ™Ö');

                    // Generate special tags HTML
                    const specialTagsHtml = parsedName.specialTags && parsedName.specialTags.length > 0 
                        ? parsedName.specialTags.map(tag => 
                            `<span class="comment-special-tag ${tag.type}">${tag.text}</span>`
                          ).join('')
                        : '';

                    return `
                        <div class="comment-item ${isOwn ? 'own-comment' : ''}">
                            <div class="comment-header">
                                <div class="comment-info">
                                    <div class="comment-name-wrapper">
                                        ${parsedName.name}
                                        ${specialTagsHtml}
                                    </div>
                                    <span class="comment-time">${formatDate(comment.timestamp)}</span>
                                </div>
                                ${deleteButton}
                            </div>
                            <div class="comment-text">${escapeHtml(comment.text || '')}</div>
                        </div>
                    `;
                }).join('');
            }

            // Submit comment
            function submitComment() {

                const nameInput = document.getElementById('comment-name');
                const textInput = document.getElementById('comment-text');
                const submitBtn = document.getElementById('comment-submit');

                const name = nameInput.value.trim();
                const text = textInput.value.trim();

                if (!name || !text) {
                    alert('Ïù¥Î¶ÑÍ≥º ÎåìÍ∏ÄÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                // Disable submit button to prevent double submission
                submitBtn.disabled = true;
                submitBtn.textContent = 'Ï†ÑÏÜ° Ï§ë...';

                // Validate required fields
                if (name.length < 2) {
                    alert('Ïù¥Î¶ÑÏùÄ ÏµúÏÜå 2Ïûê Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    nameInput.focus();
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Î≥¥ÎÇ¥Í∏∞';
                    return;
                }

                if (text.length < 2) {
                    alert('ÎåìÍ∏ÄÏùÄ ÏµúÏÜå 2Ïûê Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    textInput.focus();
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Î≥¥ÎÇ¥Í∏∞';
                    return;
                }

                if (name.length > 50) {
                    alert('Ïù¥Î¶ÑÏùÄ 50Ïûê Ïù¥ÎÇ¥Î°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    nameInput.focus();
                    return;
                }

                if (text.length > 500) {
                    alert('ÎåìÍ∏ÄÏùÄ 500Ïûê Ïù¥ÎÇ¥Î°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    textInput.focus();
                    return;
                }

                // Get project info for teamId
                const project = currentProjects.find(p => p.cardId === currentCommentCardId);

                const comment = {
                    name: name,
                    text: text,
                    timestamp: Date.now(),
                    authorId: generateAuthorId(name), // Add author ID for tracking own comments
                    cardId: currentCommentCardId,
                    teamId: currentCommentCardId // Use cardId as teamId
                };

                // Add to D1 database
                fetch('https://jeiu.cc/api/comments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        text: text,
                        authorId: generateAuthorId(name),
                        cardId: currentCommentCardId,
                        teamId: currentCommentCardId
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Comment added with ID:', data.id);

                        // Save current name to localStorage
                        const name = nameInput.value.trim();
                        localStorage.setItem('currentCommentName', name);

                        // Clear form
                        nameInput.value = '';
                        textInput.value = '';

                        // Refresh comments immediately (keep modal open)
                        loadComments(currentCommentCardId);

                        console.log('Comment submitted successfully');
                    })
                    .catch((error) => {
                        console.error('ÎåìÍ∏Ä Ï†ÑÏÜ° Ïã§Ìå®:', error);

                        let errorMessage = 'ÎåìÍ∏Ä Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.';

                        if (error.message.includes('400')) {
                            errorMessage = 'ÏûÖÎ†•Í∞íÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§. Îã§Ïãú ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                        } else if (error.message.includes('500')) {
                            errorMessage = 'ÏÑúÎ≤Ñ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.';
                        } else if (error.message.includes('NETWORK')) {
                            errorMessage = 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞Ïóê Î¨∏Ï†úÍ∞Ä ÏûàÏäµÎãàÎã§. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                        }

                        alert(errorMessage);

                        // Re-enable button
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Î≥¥ÎÇ¥Í∏∞';
                    });
            }

            // Generate author ID based on name and browser fingerprint
            function generateAuthorId(name) {
                const nameKey = name.toLowerCase().trim();
                let authorId = localStorage.getItem(`authorId_${nameKey}`);

                if (!authorId) {
                    // Create a simple fingerprint from browser info
                    const fingerprint = navigator.userAgent + navigator.language + screen.width + screen.height;
                    // Use proper UTF-8 encoding for btoa
                    const data = nameKey + fingerprint;
                    try {
                        authorId = btoa(unescape(encodeURIComponent(data))).substring(0, 16);
                    } catch (error) {
                        // Fallback for very old browsers
                        authorId = 'author_' + Math.random().toString(36).substring(2, 18);
                    }
                    localStorage.setItem(`authorId_${nameKey}`, authorId);
                }

                return authorId;
            }

            // Delete comment from D1 database
            window.deleteComment = function (cardId, commentId) {
                if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }

                fetch(`https://jeiu.cc/api/comments?commentId=${encodeURIComponent(commentId)}&teamId=${encodeURIComponent(cardId)}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Comment deleted successfully');
                        // Refresh comments
                        loadComments(cardId);
                    })
                    .catch((error) => {
                        console.error('Error deleting comment:', error);
                        alert('ÎåìÍ∏Ä ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    });
            };

            // Check if comment is written by current user
            function isOwnComment(comment) {
                if (!comment.author_id) return false;

                // Try to get current author ID from localStorage for all possible names
                const storedNames = Object.keys(localStorage).filter(key => key.startsWith('authorId_'));

                for (const storageKey of storedNames) {
                    const storedAuthorId = localStorage.getItem(storageKey);
                    if (storedAuthorId === comment.author_id) {
                        return true;
                    }
                }

                // Also check current name field if filled
                const currentNameField = document.getElementById('comment-name');
                if (currentNameField && currentNameField.value.trim()) {
                    const currentNameKey = currentNameField.value.trim().toLowerCase();
                    const currentAuthorId = localStorage.getItem(`authorId_${currentNameKey}`);
                    if (currentAuthorId === comment.author_id) {
                        return true;
                    }
                }

                return false;
            }

            // Update comment count
            function updateCommentCount(cardId, count) {

                const commentBtn = document.querySelector(`.comment-count[data-card-id="${cardId}"]`);
                if (commentBtn) {
                    const commentNumber = commentBtn.querySelector('.comment-number');
                    if (commentNumber) {
                        const oldCount = commentNumber.textContent;
                        commentNumber.textContent = count;
                    } else {
                        console.error(`Comment number element not found for card ${cardId}`);
                    }
                } else {
                    console.error(`Comment button not found for card ${cardId}`);
                }
            }

            // Load all comment counts from D1 API
            function loadCommentCounts() {
                // Get comment counts from D1 API
                fetch('https://jeiu.cc/api/comment-counts')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Update counts for each card
                        document.querySelectorAll('.comment-count').forEach(commentBtn => {
                            const cardId = commentBtn.dataset.cardId;

                            if (data.counts && data.counts[cardId]) {
                                const count = data.counts[cardId];
                                updateCommentCount(cardId, count);
                            } else {
                                updateCommentCount(cardId, 0);
                            }
                        });
                    })
                    .catch((error) => {
                        console.error('Error loading comment counts:', error);
                    });

                // Set up polling for comment count updates (every 10 seconds)
                setInterval(() => {
                    fetch('https://jeiu.cc/api/comment-counts')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            // Update counts for each card
                            document.querySelectorAll('.comment-count').forEach(commentBtn => {
                                const cardId = commentBtn.dataset.cardId;

                                if (data.counts && data.counts[cardId]) {
                                    const count = data.counts[cardId];
                                    updateCommentCount(cardId, count);
                                } else {
                                    updateCommentCount(cardId, 0);
                                }
                            });
                        })
                        .catch((error) => {
                            console.error('Error polling comment counts:', error);
                        });
                }, 10000);
            }

            // Initialize comment counts (separate function for initial load)
            function initializeCommentCounts() {
                if (currentProjects.length === 0) {
                    setTimeout(initializeCommentCounts, 1000);
                    return;
                }

                // console.log('Initializing comment counts for', currentProjects.length, 'projects');

                // Load initial counts from D1 API
                loadCommentCounts();
                // console.log('Comment counts initialized from D1 API');
            }

            // Utility functions
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            function formatDate(timestamp) {
                if (!timestamp) return 'Ïïå Ïàò ÏóÜÏùå';
                const date = new Date(timestamp);
                const now = new Date();
                const diff = now - date;

                // 1Î∂Ñ Ïù¥ÎÇ¥: "Î∞©Í∏à Ï†Ñ"
                if (diff < 60000) {
                    return 'Î∞©Í∏à Ï†Ñ';
                }

                // 1ÏãúÍ∞Ñ Ïù¥ÎÇ¥: "XÎ∂Ñ Ï†Ñ"
                if (diff < 3600000) {
                    const minutes = Math.floor(diff / 60000);
                    return `${minutes}Î∂Ñ Ï†Ñ`;
                }

                // 24ÏãúÍ∞Ñ Ïù¥ÎÇ¥: "XÏãúÍ∞Ñ Ï†Ñ"
                if (diff < 86400000) {
                    const hours = Math.floor(diff / 3600000);
                    return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
                }

                // 7Ïùº Ïù¥ÎÇ¥: "XÏùº Ï†Ñ"
                if (diff < 604800000) {
                    const days = Math.floor(diff / 86400000);
                    return `${days}Ïùº Ï†Ñ`;
                }

                // Í∑∏ Ïô∏: ÎÇ†Ïßú ÌëúÏãú
                return date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            function formatTime(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = now - date;

                if (diff < 60000) return 'Î∞©Í∏à';
                if (diff < 3600000) return `${Math.floor(diff / 60000)}Î∂Ñ Ï†Ñ`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)}ÏãúÍ∞Ñ Ï†Ñ`;
                if (diff < 604800000) return `${Math.floor(diff / 86400000)}Ïùº Ï†Ñ`;

                return date.toLocaleDateString('ko-KR');
            }

            // Setup comment modal event listeners
            function setupCommentModal() {
                // Close button
                document.getElementById('close-comment-modal').addEventListener('click', closeCommentModal);

                // Submit button
                document.getElementById('comment-submit').addEventListener('click', submitComment);

                // Name field validation and character count
                document.getElementById('comment-name').addEventListener('input', function () {
                    const name = this.value.trim();
                    localStorage.setItem('currentCommentName', name);

                    // Update character count
                    const nameCount = document.getElementById('name-count');
                    if (nameCount) {
                        nameCount.textContent = `${name.length}/50`;
                        if (name.length > 50) {
                            nameCount.classList.add('warning');
                        } else {
                            nameCount.classList.remove('warning');
                        }
                    }

                    // Refresh comments to show/hide delete buttons
                    if (currentCommentCardId) {
                        loadComments(currentCommentCardId);
                    }
                });

                // Text field validation and character count
                document.getElementById('comment-text').addEventListener('input', function () {
                    const text = this.value.trim();

                    // Update character count
                    const textCount = document.getElementById('text-count');
                    if (textCount) {
                        textCount.textContent = `${text.length}/500`;
                        if (text.length > 500) {
                            textCount.classList.add('warning');
                        } else {
                            textCount.classList.remove('warning');
                        }
                    }
                });

                // Enter key handling for name field
                document.getElementById('comment-name').addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('comment-text').focus();
                    }
                });

                // Emoji insertion function
                function insertEmoji(emoji) {
                    const textArea = document.getElementById('comment-text');
                    const start = textArea.selectionStart;
                    const end = textArea.selectionEnd;

                    const text = textArea.value;

                    const newText = text.substring(0, start) + emoji + text.substring(end);
                    textArea.value = newText;

                    // Set cursor position after emoji
                    textArea.focus();
                    textArea.setSelectionRange(start + emoji.length, start + emoji.length);

                    // Trigger input event to update character count
                    textArea.dispatchEvent(new Event('input'));
                }

                // Emoji button click handlers
                document.querySelectorAll('.emoji-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const emoji = this.dataset.emoji;
                        insertEmoji(emoji);
                    });
                });

                // Close modal when clicking outside
                document.getElementById('comment-modal').addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeCommentModal();
                    }
                });
            }

            // Ïù¥ÎØ∏ÏßÄ Î°úÎî© ÏµúÏ†ÅÌôî (ÏàòÎèô lazy loading)
            function optimizeImageLoading() {
                // Intersection Observer for manual lazy loading
                if ('IntersectionObserver' in window) {
                    const lazyImageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                const dataSrc = img.getAttribute('data-src');

                                if (dataSrc) {
                                    img.src = dataSrc;
                                    img.removeAttribute('data-src');
                                    img.classList.remove('lazy-image');
                                    img.classList.add('loaded');
                                }

                                observer.unobserve(img);
                            }
                        });
                    }, {
                        rootMargin: '100px 0px',
                        threshold: 0.01
                    });

                    // Observe all lazy images
                    document.querySelectorAll('.lazy-image').forEach(img => {
                        lazyImageObserver.observe(img);
                    });
                } else {
                    // Fallback for older browsers - load all images immediately
                    document.querySelectorAll('.lazy-image').forEach(img => {
                        const dataSrc = img.getAttribute('data-src');
                        if (dataSrc) {
                            img.src = dataSrc;
                            img.removeAttribute('data-src');
                            img.classList.remove('lazy-image');
                        }
                    });
                }
            }

            // Ïù¥ÎØ∏ÏßÄ ÏóêÎü¨ Ìï∏Îì§ÎßÅ Í∞úÏÑ†
            function setupImageErrorHandling() {
                document.querySelectorAll('img').forEach(img => {
                    img.addEventListener('error', function () {
                        // Add retry mechanism
                        if (!this.dataset.retryCount) {
                            this.dataset.retryCount = '0';
                        }

                        const retryCount = parseInt(this.dataset.retryCount);
                        if (retryCount < 3) {
                            this.dataset.retryCount = (retryCount + 1).toString();
                            setTimeout(() => {
                                const src = this.src;
                                const dataSrc = this.getAttribute('data-src');

                                // Retry with current src or data-src for lazy images
                                if (dataSrc) {
                                    this.src = '';
                                    this.src = dataSrc;
                                } else if (src) {
                                    this.src = '';
                                    this.src = src;
                                }
                            }, 1000 * retryCount);
                        } else {
                            // Final fallback
                            this.style.display = 'none';
                            const parent = this.parentElement;
                            if (parent) {
                                parent.style.background = 'linear-gradient(135deg,#ff4d00,#ff8c00)';
                            }
                        }
                    });
                });
            }

            // Ï∫êÏãú ÏµúÏ†ÅÌôî Ï¥àÍ∏∞Ìôî
            function initializeCacheOptimization() {
                optimizeImageLoading();
                
                // Hide loading indicator when content is ready
                setTimeout(() => {
                    if (typeof updateLoadingProgress === 'function') {
                        updateLoadingProgress(100);
                    }
                    setTimeout(() => {
                        if (typeof hideLoadingIndicator === 'function') {
                            hideLoadingIndicator();
                        }
                    }, 300);
                }, 500);
                setupImageErrorHandling();

                // Service Worker Îì±Î°ù (ÎÇòÏ§ëÏóê Ï∂îÍ∞Ä Í∞ÄÎä•)
                if ('serviceWorker' in navigator) {
                    // Service Worker Îì±Î°ù ÏΩîÎìúÎäî ÎÇòÏ§ëÏóê Ï∂îÍ∞Ä
                }
            }
            let currentVideoData = {
                interimUrl: '',
                finalUrl: '',
                currentType: 'interim',
                interimDocUrl: '',
                finalDocUrl: ''
            };

            let teamData = {}; // ÌåÄ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•

            function extractVideoId(url) {
                const reg = /^.*(youtu.be\/|v\/|embed\/|watch\?v=)([^#&?]*).*/;
                const m = url.match(reg);
                return m && m[2]?.length === 11 ? m[2] : null;
            }

            function switchVideoTab(type) {
                const tabs = document.querySelectorAll('.tab-button');
                const modal = document.getElementById('video-modal');
                const videoFrame = document.getElementById('video-frame');
                const docLink = document.getElementById('doc-link');
                const docButtonContainer = document.querySelector('.doc-button-container');

                // Update tab active states
                tabs.forEach(tab => {
                    if (tab.dataset.videoType === type) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });

                // Update current type and load video
                currentVideoData.currentType = type;
                const videoUrl = type === 'interim' ? currentVideoData.interimUrl : currentVideoData.finalUrl;
                const docUrl = type === 'interim' ? currentVideoData.interimDocUrl : currentVideoData.finalDocUrl;

                // Load video
                if (videoUrl) {
                    const videoId = extractVideoId(videoUrl);
                    if (videoId) {
                        videoFrame.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                        videoFrame.style.display = 'block';
                    } else {
                        videoFrame.style.display = 'none';
                    }
                } else {
                    videoFrame.style.display = 'none';
                }

                // Handle document
                if (docUrl) {
                    docLink.href = docUrl;
                    docLink.textContent = type === 'interim' ? 'Ï§ëÍ∞ÑÎ∞úÌëúÏûêÎ£å Î≥¥Í∏∞' : 'ÏµúÏ¢ÖÎ∞úÌëúÏûêÎ£å Î≥¥Í∏∞';
                    docLink.style.pointerEvents = 'auto';
                    docLink.style.opacity = '1';
                    docButtonContainer.style.display = 'block';
                } else {
                    docLink.textContent = type === 'interim' ? 'Ï§ëÍ∞ÑÎ∞úÌëúÏûêÎ£å Î≥¥Í∏∞' : 'ÏµúÏ¢ÖÎ∞úÌëúÏûêÎ£å Î≥¥Í∏∞';
                    docLink.style.pointerEvents = 'none';
                    docLink.style.opacity = '0.5';
                    docButtonContainer.style.display = 'block';
                }
            }

            function setupVideoButtons() {
                document.querySelectorAll(".embed-video").forEach(btn => {
                    btn.onclick = e => {
                        e.preventDefault();

                        // Store video data
                        currentVideoData.interimUrl = btn.dataset.interimUrl;
                        currentVideoData.finalUrl = btn.dataset.finalUrl;
                        currentVideoData.interimDocUrl = btn.dataset.interimDocUrl || '';
                        currentVideoData.finalDocUrl = btn.dataset.finalDocUrl || '';

                        // Reset to interim tab initially
                        currentVideoData.currentType = 'interim';

                        // Show modal and setup tabs
                        const modal = document.getElementById('video-modal');
                        modal.style.display = 'block';

                        // Setup tab functionality
                        const tabs = document.querySelectorAll('.tab-button');
                        tabs.forEach(tab => {
                            tab.onclick = () => switchVideoTab(tab.dataset.videoType);
                        });

                        // Initially show interim video or final if interim doesn't exist
                        const initialType = currentVideoData.interimUrl ? 'interim' : 'final';
                        switchVideoTab(initialType);

                        // Hide tabs that don't have videos
                        if (!currentVideoData.interimUrl) {
                            document.querySelector('[data-video-type="interim"]').style.display = 'none';
                        } else {
                            document.querySelector('[data-video-type="interim"]').style.display = 'block';
                        }

                        if (!currentVideoData.finalUrl) {
                            document.querySelector('[data-video-type="final"]').style.display = 'none';
                        } else {
                            document.querySelector('[data-video-type="final"]').style.display = 'block';
                        }
                    };
                });
            }

            document.getElementById("close-modal").onclick = () => {
                document.getElementById("video-modal").style.display = "none";
                document.getElementById("video-frame").src = "";
            };

            /* ------------------------- ÌïòÌä∏ Í∏∞Îä• ------------------------- */
            let heartClickTimeouts = {};

            function createHeartAnimation(x, y) {
                const heart = document.createElement('div');
                heart.className = 'heart-animation';
                heart.innerHTML = '‚ù§Ô∏è';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                document.body.appendChild(heart);

                setTimeout(() => {
                    heart.remove();
                }, 1500);
            }

            /* -------------------------- Firebase Ïó∞Í≤∞ ÌôïÏù∏ -------------------------- */
            let firebaseConnected = false;
            let heartFunctionsEnabled = false;

            function checkFirebaseConnection() {
                const statusElement = document.getElementById('firebase-status');
                const connectedRef = database.ref('.info/connected');

                connectedRef.on('value', (snapshot) => {
                    const connected = snapshot.val();
                    firebaseConnected = connected;

                    if (connected) {
                        // Ïó∞Í≤∞ÎêòÎ©¥ ÌïòÌä∏ Í∏∞Îä• ÌôúÏÑ±Ìôî
                        if (!heartFunctionsEnabled) {
                            heartFunctionsEnabled = true;
                        }
                    } else {
                        // Ïó∞Í≤∞ Ìï¥Ï†ú Ïãú ÌïòÌä∏ Í∏∞Îä• ÎπÑÌôúÏÑ±Ìôî
                        heartFunctionsEnabled = false;
                    }
                });
            }

            async function incrementHeartCount(cardId) {
                if (!firebaseConnected || !heartFunctionsEnabled) {
                    return;
                }

                try {
                    const heartRef = database.ref(`hearts/${cardId}`);

                    const snapshot = await heartRef.once('value');
                    const currentCount = snapshot.val() || 0;

                    // ÌïòÌä∏ Ï∂îÍ∞Ä (Î¨¥Ï†úÌïú)
                    const newCount = currentCount + 1;
                    await heartRef.set(newCount);

                } catch (error) {
                    console.error('ÌïòÌä∏ Ïπ¥Ïö¥Ìä∏ Î≥ÄÍ≤Ω Ïã§Ìå®:', error);
                }
            }

            async function loadHeartCounts() {
                try {
                    const heartsRef = database.ref('hearts');
                    heartsRef.on('value', (snapshot) => {
                        const heartsData = snapshot.val() || {};

                        document.querySelectorAll('.card-image').forEach(cardImage => {
                            const cardId = cardImage.dataset.cardId;
                            const heartNumber = cardImage.querySelector('.heart-number');
                            if (heartNumber) {
                                heartNumber.textContent = heartsData[cardId] || 0;
                            }
                        });
                    });
                } catch (error) {
                    console.error('ÌïòÌä∏ Ïπ¥Ïö¥Ìä∏ Î°úÎìú Ïã§Ìå®:', error);
                }
            }

            function setupHeartClickListeners() {
                document.querySelectorAll('.card-image').forEach(cardImage => {
                    cardImage.addEventListener('click', function (e) {
                        const cardId = this.dataset.cardId;

                        // 0.5Ï¥à Ïó∞ÌÉÄ Î∞©ÏßÄ
                        if (heartClickTimeouts[cardId]) {
                            return;
                        }

                        heartClickTimeouts[cardId] = true;
                        setTimeout(() => {
                            delete heartClickTimeouts[cardId];
                        }, 500);

                        // ÌïòÌä∏ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏÉùÏÑ± - Ïπ¥Îìú ÎÇ¥ ÏÉÅÎåÄ ÏúÑÏπòÎ°ú ÏàòÏ†ï
                        const rect = this.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;

                        const heart = document.createElement('div');
                        heart.className = 'heart-animation';
                        heart.innerHTML = '‚ù§Ô∏è';
                        heart.style.left = x + 'px';
                        heart.style.top = y + 'px';
                        this.style.position = 'relative';
                        this.appendChild(heart);

                        setTimeout(() => {
                            heart.remove();
                        }, 1500);

                        // ÌïòÌä∏ Ïπ¥Ïö¥Ìä∏ Ï¶ùÍ∞Ä
                        incrementHeartCount(cardId);
                    });
                });
            }

            function setupStudentSpeechBubbles() {
                let currentBubble = null;
                let hideTimeout = null;
                let isCreatingBubble = false; // Prevent multiple bubble creation
                let lastRequestedBubble = null; // Track last requested bubble

                // Ï†ÑÏó≠ Ìï®ÏàòÎ°ú hideSpeechBubble ÎÖ∏Ï∂ú
                window.hideSpeechBubble = hideSpeechBubble;

                // FlickingÏù¥ Ï¥àÍ∏∞ÌôîÎêú ÌõÑÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
                setTimeout(() => {
                    document.querySelectorAll('.member-avatar').forEach(avatar => {
                        // mousedown Ïù¥Î≤§Ìä∏Î°ú Î≥ÄÍ≤Ω
                        avatar.addEventListener('mousedown', function (e) {
                            e.preventDefault();
                            e.stopPropagation();

                            const memberName = this.parentElement.querySelector('.member-name').textContent;
                            showSpeechBubble(this, memberName);
                        });

                        // Î™®Î∞îÏùº ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                        avatar.addEventListener('touchstart', function (e) {
                            e.preventDefault();
                            e.stopPropagation();

                            const memberName = this.parentElement.querySelector('.member-name').textContent;
                            showSpeechBubble(this, memberName);
                        });

                        // Î™®Î∞îÏùºÏóêÏÑú ÌÑ∞Ïπò ÌõÑ ÎóÑ ÎïåÎèÑ Ìä∏Î¶¨Í±∞ (ÏïàÏ†ïÏÑ± ÌôïÎ≥¥)
                        avatar.addEventListener('touchend', function (e) {
                            e.preventDefault();
                            e.stopPropagation();

                            const memberName = this.parentElement.querySelector('.member-name').textContent;
                            showSpeechBubble(this, memberName);
                        });
                    });
                }, 500); // Flicking Ï¥àÍ∏∞Ìôî ÎåÄÍ∏∞

                function showSpeechBubble(element, studentName) {
                    // Prevent multiple bubble creation
                    if (isCreatingBubble) {
                        lastRequestedBubble = { element, studentName };
                        return;
                    }

                    isCreatingBubble = true;

                    // Í∏∞Ï°¥ ÎßêÌíçÏÑ† Ï¶âÏãú Ï†úÍ±∞
                    if (currentBubble) {
                        if (currentBubble.parentNode) {
                            currentBubble.parentNode.removeChild(currentBubble);
                        }
                        currentBubble = null;
                    }
                    if (hideTimeout) {
                        clearTimeout(hideTimeout);
                        hideTimeout = null;
                    }

                    // ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                    loadStudentData().then(students => {
                        const studentData = students[studentName];
                        const message = studentData?.ÏÜåÍ∞ê || "ÌõÑÌöåÏóÜÎäî Ï∫°Ïä§ÌÜ§Ïù¥ÏóàÏñ¥!";

                        // ÎßêÌíçÏÑ† ÏÉùÏÑ±
                        const bubble = document.createElement('div');
                        bubble.className = 'speech-bubble';
                        bubble.textContent = message;

                        // ÏúÑÏπò ÏÑ§Ï†ï - Safari-compatible positioning
                        bubble.style.position = 'absolute'; // Use absolute instead of fixed for Safari

                        const rect = element.getBoundingClientRect();
                        const bubbleWidth = 200; // ÏµúÎåÄ ÎÑàÎπÑ

                        // Calculate position relative to viewport
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

                        const bubbleLeft = rect.left + scrollLeft + (rect.width / 2) - (bubbleWidth / 2);
                        const bubbleTop = rect.top + scrollTop - 60; // ÎßêÌíçÏÑ† ÎÜíÏù¥ + Ïó¨Î∞±

                        bubble.style.left = bubbleLeft + 'px';
                        bubble.style.top = bubbleTop + 'px';
                        bubble.style.width = bubbleWidth + 'px';

                        // ÌôîÎ©¥ Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
                        const screenWidth = window.innerWidth;
                        const screenHeight = window.innerHeight;

                        if (bubbleLeft < 10) {
                            bubble.style.left = '10px';
                        } else if (bubbleLeft + bubbleWidth > screenWidth - 10) {
                            bubble.style.left = (screenWidth - bubbleWidth - 10) + 'px';
                        }

                        if (bubbleTop < 10) {
                            bubble.style.top = (rect.bottom + scrollTop + 10) + 'px'; // ÏúÑÏóê Í≥µÍ∞ÑÏù¥ ÏóÜÏúºÎ©¥ ÏïÑÎûòÎ°ú
                        }

                        // Append to body for proper positioning
                        document.body.appendChild(bubble);

                        // Safari-compatible animation
                        requestAnimationFrame(() => {
                            bubble.classList.add('show');
                        });

                        currentBubble = bubble;
                        isCreatingBubble = false;

                        // Check if there's a pending request
                        if (lastRequestedBubble) {
                            const pending = lastRequestedBubble;
                            lastRequestedBubble = null;
                            // Only show new bubble if it's different
                            if (pending.element !== element || pending.studentName !== studentName) {
                                setTimeout(() => showSpeechBubble(pending.element, pending.studentName), 100);
                            }
                        }

                        // 3Ï¥à ÌõÑ ÏûêÎèô Ïà®ÍπÄ
                        hideTimeout = setTimeout(() => {
                            hideSpeechBubble();
                        }, 3000);
                    });
                }

                function hideSpeechBubble() {
                    if (currentBubble) {
                        // Safari-compatible hiding
                        currentBubble.classList.remove('show');

                        // Force reflow for Safari
                        currentBubble.offsetHeight;

                        // Use shorter timeout for Safari
                        setTimeout(() => {
                            if (currentBubble && currentBubble.parentNode) {
                                currentBubble.parentNode.removeChild(currentBubble);
                                currentBubble = null;
                            }
                        }, 300);
                    }

                    // Clear timeout
                    if (hideTimeout) {
                        clearTimeout(hideTimeout);
                        hideTimeout = null;
                    }
                }

                // Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú ÎßêÌíçÏÑ† Ïà®ÍπÄ
                document.addEventListener('click', function (e) {
                    // Safari-compatible target checking
                    const target = e.target;
                    const isAvatar = target.closest ? target.closest('.member-avatar') :
                        (target.className && target.className.indexOf('member-avatar') >= 0);

                    if (!isAvatar) {
                        hideSpeechBubble();
                    }
                });

                document.addEventListener('touchend', function (e) {
                    // Safari-compatible target checking
                    const target = e.target;
                    const isAvatar = target.closest ? target.closest('.member-avatar') :
                        (target.className && target.className.indexOf('member-avatar') >= 0);

                    if (!isAvatar) {
                        hideSpeechBubble();
                    }
                });

                // Ïä§ÌÅ¨Î°§ Ïãú ÎßêÌíçÏÑ† Ïà®ÍπÄ
                window.addEventListener('scroll', function () {
                    hideSpeechBubble();
                });

                // ÌÑ∞Ïπò Ïä§ÌÅ¨Î°§ Ïãú ÎßêÌíçÏÑ† Ïà®ÍπÄ (Î™®Î∞îÏùº ÎåÄÏùë)
                window.addEventListener('touchmove', function () {
                    hideSpeechBubble();
                });

                // Safari-specific: Add visibility change listener
                document.addEventListener('visibilitychange', function () {
                    if (document.hidden) {
                        hideSpeechBubble();
                    }
                });
            }

            /* ------------------------- Exhibition Video ------------------------- */
            function setupExhibitionVideo() {
                const exhibitionBtn = document.getElementById('exhibition-video-btn');
                const exhibitionModal = document.getElementById('exhibition-modal');
                const exhibitionClose = document.getElementById('close-exhibition-modal');
                const exhibitionFrame = document.getElementById('exhibition-video-frame');

                const exhibitionVideoId = '_fo7yEdSQVA';
                const exhibitionVideoUrl = `https://www.youtube.com/embed/${exhibitionVideoId}?autoplay=1&rel=0&modestbranding=1`;

                exhibitionBtn.addEventListener('click', function () {
                    exhibitionModal.style.display = 'block';
                    exhibitionFrame.src = exhibitionVideoUrl;
                    document.body.style.overflow = 'hidden';
                });

                exhibitionClose.addEventListener('click', function () {
                    closeExhibitionModal();
                });

                exhibitionModal.addEventListener('click', function (e) {
                    if (e.target === exhibitionModal) {
                        closeExhibitionModal();
                    }
                });

                function closeExhibitionModal() {
                    exhibitionModal.style.display = 'none';
                    exhibitionFrame.src = '';
                    document.body.style.overflow = 'auto';
                }
            }

            /* ------------------------- Field Video ------------------------- */
            function setupFieldVideo() {
                const fieldBtn = document.getElementById('field-video-btn');
                const fieldModal = document.getElementById('field-modal');
                const fieldClose = document.getElementById('close-field-modal');
                const fieldFrame = document.getElementById('field-video-frame');

                const fieldVideoId = 'b8AS-b1fMn4';
                const fieldVideoUrl = `https://www.youtube.com/embed/${fieldVideoId}?autoplay=1&rel=0&modestbranding=1`;

                fieldBtn.addEventListener('click', function () {
                    fieldModal.style.display = 'block';
                    fieldFrame.src = fieldVideoUrl;
                    document.body.style.overflow = 'hidden';
                });

                fieldClose.addEventListener('click', function () {
                    closeFieldModal();
                });

                fieldModal.addEventListener('click', function (e) {
                    if (e.target === fieldModal) {
                        closeFieldModal();
                    }
                });

                function closeFieldModal() {
                    fieldModal.style.display = 'none';
                    fieldFrame.src = '';
                    document.body.style.overflow = 'auto';
                }
            }


            /* ------------------------- Ïó∞ÎèÑ ÏÑ†ÌÉù Î©îÎâ¥ ------------------------- */
            function setupArchiveMenu() {
                const btn = document.getElementById("archive-button");
                const dropdown = document.getElementById("archive-dropdown");
                const label = document.querySelector(".archive-label");

                btn.onclick = e => {
                    e.stopPropagation();
                    btn.classList.toggle("active");
                    dropdown.classList.toggle("open");
                };

                document.querySelectorAll(".archive-option").forEach(opt => {
                    opt.onclick = () => {
                        label.textContent = opt.dataset.year;

                        document
                            .querySelector(".archive-option.active")
                            ?.classList.remove("active");

                        opt.classList.add("active");
                        btn.classList.remove("active");
                        dropdown.classList.remove("open");

                        generateTeamCards(opt.dataset.year);
                    };
                });

                document.onclick = e => {
                    if (!btn.contains(e.target)) {
                        btn.classList.remove("active");
                        dropdown.classList.remove("open");
                    }
                };
            }

            /* -------------------------- Ï¥àÍ∏∞ Ïã§Ìñâ -------------------------- */
            setupArchiveMenu();
            generateTeamCards("2025");

            // Firebase Ïó∞Í≤∞ ÌôïÏù∏ ÏãúÏûë
            setTimeout(() => {
                checkFirebaseConnection();
            }, 1000);
        }

        const flickScript = document.createElement("script");
        flickScript.src = "/assets/js/flicking.pkgd.min.js";

        flickScript.onload = () => {
            // Flicking loaded

            // FirebaseÍ∞Ä Ï§ÄÎπÑÎê† ÎïåÍπåÏßÄ Í∏∞Îã§Î†∏Îã§Í∞Ä startApp Ïã§Ìñâ
            if (typeof firebase !== 'undefined' && firebase.database()) {
                // Firebase ready!
                firebaseConnected = true;
                startApp();
            } else {
                console.error("Firebase not loaded properly");
            }
        };

        document.head.appendChild(flickScript);
    </script>
</head>

<body>

    <!-- Loading Indicator -->
    <div id="loading-indicator" class="loading-indicator">
        <div class="loading-spinner"></div>
        <div class="loading-text">JEIU Creative Collection Î°úÎî© Ï§ë...</div>
        <div class="loading-progress">
            <div class="progress-bar"></div>
        </div>
    </div>

    <!-- QR Code (Desktop Only) -->
    <div class="qr-code-container">
        <img src="img/qrcodes.png" decoding="async" alt="QR Codes" class="qr-code-image">
        <div class="qr-code-text">
            <div class="qr-code-url">JEIU.CC</div>
            <div class="qr-code-instruction">Î™®Î∞îÏùºÎ°ú</br>Ï†ëÏÜçÌï¥Ï£ºÏÑ∏Ïöî</div>
        </div>
    </div>

    <!-- WebGL Canvas Background -->
    <div id="canvas-container">
        <canvas id="glCanvas"></canvas>
    </div>

    <!-- Grain Overlay -->
    <div class="noise-overlay"></div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-top">
                    <div class="archive-menu">
                        <div class="archive-selector">
                            <div class="archive-button" id="archive-button">
                                <span class="archive-label">2025</span>
                            </div>
                            <div class="archive-dropdown" id="archive-dropdown">
                                <div class="archive-option active" data-year="2025">2025</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="logo-container">
                    <img src="jeiu-logo.svg" class="jeiu-logo">
                </div>

                <span class="brand-tag">Creative Collection</span>
                <h2>Computer Software<br>Capstone Projects</h2>
                <p class="subtitle">
                    Ïû¨Îä•ÎåÄÌïôÍµê Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º Ï°∏ÏóÖÏûëÌíà ÏïÑÏπ¥Ïù¥Î∏å.<br>
                    ÌïôÏÉùÎì§Ïùò Ïó¥Ï†ïÍ≥º Í∏∞Ïà†Ïù¥ Îã¥Í∏¥ ÌîÑÎ°úÏ†ùÌä∏Îì§ÏùÑ ÏòÅÍµ¨Ìûà Í∏∞Î°ùÌï©ÎãàÎã§.
                </p>

                <marquee class="heart-instruction">ÎßàÏùåÏóê ÎìúÎäî ÌîÑÎ°úÏ†ùÌä∏Ïóê ÌïòÌä∏Î•º ÎàåÎü¨Ï£ºÏÑ∏Ïöî!</marquee>

                <!-- Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà -->
                <div class="button-container">
                    <!-- ÏµúÏ¢ÖÎ∞úÌëúÌòÑÏû•ÌïòÏù¥ÎùºÏù¥Ìä∏ Î≤ÑÌäº -->
                    <button id="exhibition-video-btn" class="action-btn exhibition-video-btn" data-text="ÏµúÏ¢ÖÎ∞úÌëú">
                        üé¨ ÏµúÏ¢Ö Î∞úÌëú
                    </button>

                    <!-- ÌòÑÏû•ÏòÅÏÉÅ Î≤ÑÌäº -->
                    <button id="field-video-btn" class="action-btn field-video-btn" data-text="ÌòÑÏû•ÏòÅÏÉÅ">
                        üìπ ÌòÑÏû• ÏòÅÏÉÅ
                    </button>

                    <!-- ÏÖîÌîå Ïπ¥Îìú Î≤ÑÌäº -->
                    <button id="shuffle-cards-btn" class="action-btn shuffle-cards-btn" data-text="Ïπ¥ÎìúÏÑûÍ∏∞">
                        üîÄ Ïπ¥Îìú ÏÑûÍ∏∞
                    </button>
                </div>
            </div>
        </header>

        <section class="gallery-section">
            <div class="grid" id="project-grid"></div>
        </section>

        <!-- Exhibition Video Modal -->
        <div id="exhibition-modal" class="exhibition-modal">
            <div class="exhibition-modal-content">
                <span class="exhibition-close" id="close-exhibition-modal">&times;</span>
                <div class="exhibition-video-container">
                    <iframe id="exhibition-video-frame" width="100%" height="100%" src="" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>

        <!-- Field Video Modal -->
        <div id="field-modal" class="exhibition-modal">
            <div class="exhibition-modal-content">
                <span class="exhibition-close" id="close-field-modal">&times;</span>
                <div class="exhibition-video-container">
                    <iframe id="field-video-frame" width="100%" height="100%" src="" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="video-modal" class="modal">
            <div class="modal-content">
                <span class="close" id="close-modal">&times;</span>
                <div class="video-container">
                    <iframe id="video-frame" width="100%" height="400" allowfullscreen></iframe>
                </div>
                <div class="doc-button-container">
                    <a id="doc-link" href="#" target="_blank" rel="noopener" class="doc-button">Î∞úÌëúÏûêÎ£å Î≥¥Í∏∞</a>
                </div>
                <div class="video-tabs" id="video-tabs">
                    <button class="tab-button active" data-video-type="interim">Ï§ëÍ∞ÑÎ∞úÌëú</button>
                    <button class="tab-button" data-video-type="final">ÏµúÏ¢ÖÎ∞úÌëú</button>
                </div>
            </div>
        </div>

        <!-- Comment Lightbox Modal -->
        <div id="comment-modal" class="comment-modal">
            <div class="comment-modal-content">
                <div class="comment-modal-header">
                    <h3 id="comment-modal-title">üí¨ ÎåìÍ∏Ä</h3>
                    <span class="comment-close" id="close-comment-modal">&times;</span>
                </div>

                <!-- ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ (2/3) -->
                <div class="comment-list-container">
                    <div class="comment-list" id="comment-list">
                        <!-- ÎåìÍ∏ÄÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </div>
                </div>

                <!-- ÎåìÍ∏Ä ÏûÖÎ†•Ï∞Ω (ÏµúÏÜåÌôî) -->
                <div class="comment-input-container">
                    <div class="comment-input-form">
                        <input type="text" id="comment-name" placeholder="Ïù¥Î¶Ñ / Ïòà: ÍπÄÏ≤†Ïàò(OO Í∏∞ÏóÖ ÎåÄÌëú)" maxlength="50"
                            class="comment-name-input">
                        <div class="char-count" id="name-count"
                            style="text-align: right; font-size: 0.7rem; color: #666; margin-top: -3px; margin-bottom: 3px;">
                            0/50</div>
                        <textarea id="comment-text" placeholder="ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî... (2-500Ïûê)" maxlength="500"
                            class="comment-text-input"></textarea>
                        <div class="char-count" id="text-count"
                            style="text-align: right; font-size: 0.7rem; color: #666; margin-top: -3px; margin-bottom: 8px;">
                            0/500</div>

                        <!-- Í∞êÏ†ïÌëúÌòÑÍ≥º Ï†ÑÏÜ° Î≤ÑÌäºÏùÑ Í∞ôÏùÄ Ïó¥Ïóê -->
                        <div class="emoji-submit-row">
                            <!-- Í∞êÏ†ï Ïù¥Î™®ÏßÄ ÏÑ†ÌÉùÍ∏∞ -->
                            <div class="emoji-picker">
                                <div class="emoji-list">
                                    <button class="emoji-btn" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
                                    <button class="emoji-btn" data-emoji="üëç">üëç</button>
                                    <button class="emoji-btn" data-emoji="üòä">üòä</button>
                                    <button class="emoji-btn" data-emoji="üéâ">üéâ</button>
                                    <button class="emoji-btn" data-emoji="üî•">üî•</button>
                                </div>
                            </div>

                            <button id="comment-submit" class="comment-submit-btn">Î≥¥ÎÇ¥Í∏∞</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 JEIU University Computer Software Dept.</br> All rights reserved.</p>
            <div class="footer-links">
                <a href="https://www.jeiu.ac.kr" target="_blank" rel="noopener" class="backlink">
                    <span class="backlink-text">Ïû¨Îä•ÎåÄÌïôÍµê ÌôàÌéòÏù¥ÏßÄ</span>
                    <span class="backlink-url">jeiu.ac.kr</span>
                </a>
                <a href="https://dept.jeiu.ac.kr/cit/main/" target="_blank" rel="noopener" class="backlink">
                    <span class="backlink-text">Ïª¥Ìì®ÌÑ∞ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ÌïôÍ≥º</span>
                    <span class="backlink-url">dept.jeiu.ac.kr/cit</span>
                </a>
                <span id="firebase-status" class="firebase-status"></span>
            </div>
        </div>
    </footer>
    <!-- Shader Script -->
    <script src="shader.js"></script>
</body>

</html>